(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{154:function(e){e.exports={name:"nebula",version:"0.1.6",private:!0,homepage:".",dependencies:{"@erebos/api-pss":"0.5.3","@erebos/swarm-browser":"0.5.3","@mainframe/rpc-stream":"0.3.0","@material-ui/core":"4.2.0","@material-ui/icons":"4.2.1","@material-ui/styles":"4.2.0",axios:"0.19.0","connected-react-router":"6.5.2",dotenv:"8.2.0","file-saver":"2.0.0","hash-sum":"1.0.2",jsonpack:"1.1.5","lz-string":"1.4.4",prettysize:"2.0.0","prop-types":"15.6.2",react:"16.8.6","react-blockies":"1.4.0","react-copy-to-clipboard":"5.0.1","react-dom":"16.8.6","react-helmet-async":"0.2.0","react-hot-loader":"4.6.3","react-jobs":"1.0.1","react-redux":"7.1.0","react-router":"5.0.1","react-scripts":"2.1.8","react-scroll":"1.7.10",redux:"4.0.4","redux-thunk":"2.3.0",rxjs:"6.4.0"},devDependencies:{eslint:"5.12.0","eslint-plugin-react-hooks":"1.5.1",hasky:"3.0.2","release-it":"10.3.1"},scripts:{start:"react-scripts start",build:"react-scripts build",test:"react-scripts test",eject:"react-scripts eject",lint:"eslint --ext .jsx,.js --max-warnings 0 src",release:"release-it --no-npm.publish"},browserslist:[">0.2%","not dead","not ie <= 11","not op_mini all"],husky:{hooks:{"pre-commit":"npm run lint"}}}},177:function(e,t){},190:function(e,t,a){e.exports=a.p+"static/media/logo.1584bb37.svg"},198:function(e,t,a){"use strict";a.d(t,"run",function(){return s});var n=a(25),r=a(199),c=(a(177),Object(n.a)({},r.a));function s(e){window.addEventListener("message",function(t){return function(e,t){if(t||t.type){if(c[t.type])return c[t.type](e,t);console.error("Nebula::Handler not found")}else console.error("Nebula::Message is invalid")}(e,t.data)},!1),console.log("Nebula::APIs started")}},199:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var n=a(32),r=a(35),c=a(24),s=a.n(c),i=a(33);var o=Object(n.a)({},"@NEBULA::CHAT_OPEN",function(e,t){var a=t.publicKey,n=e.dispatch,c=(0,e.getState)(),o=s()(a);c.chats[o]?n(Object(r.d)("/messenger/chat/".concat(o))):n(Object(i.j)(a))})},218:function(e,t,a){e.exports=a(297)},235:function(e,t,a){},295:function(e,t,a){},297:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(20),s=a.n(c),i=a(178),o=a.n(i),l=a(200),u=a(103),p=a.n(u),d=a(13),m=a(46),b=(a(235),a(180)),f=a.n(b);var h=a(11),v=a(181),g=a(59),y=a(169),E=a(5),O=a.n(E),j=a(12),k=a(84),x=a(33),w=a(36),C="ERROR_CATCHED",T="ERROR_DISMISS";function N(e){return function(){var t=Object(j.a)(O.a.mark(function t(a){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:C,error:e});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var S="ACCOUNT_REQUEST",A="ACCOUNT_RECEIVE",z="ACCOUNT_MUTATE";function _(e){return function(){var t=Object(j.a)(O.a.mark(function t(a){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:z,account:{username:e}});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var P="APP_CONNECTING",K="APP_CONNECTED",R="APP_DISCONNECTED";var B={isStarted:!1,isConnected:!1,raw:""};function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;switch((arguments.length>1?arguments[1]:void 0).type){case K:return Object.assign({},e,{isStarted:!0,isConnected:!0});case R:return Object.assign({},e,{isStarted:!0,isConnected:!1});default:return e}}var W=a(25),D={isLoading:!1,publicKey:"",overlayAddress:"",username:""};function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object.assign({},e,{isLoading:!0});case A:return Object.assign({},e,Object(W.a)({isLoading:!1},t.account));case z:return Object.assign({},e,Object(W.a)({},t.account));default:return e}}var L={pss:"ws://127.0.0.1:8546",bzz:"http://127.0.0.1:8500",revealAddress:4},U="SETTINGS_MUTATE";var M={bzz:"",pss:"",revealAddress:0,size:0,mode:"full",home:"/"};function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return Object.assign({},e,Object(W.a)({},t.settings));default:return e}}var F=a(85);function V(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var G={};function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x.a:case x.f:case x.e:case x.d:case x.b:return Object.assign({},e,Object(W.a)({},t.contacts));case x.c:e[t.hash];var a=Object(F.a)(e,[t.hash].map(V));return Object.assign({},a);default:return e}}var J=a(32),Q=a(24),X=a.n(Q);function Z(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var Y={};function ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.a:case w.b:return Object.assign({},e,Object(W.a)({},t.chats));case w.d:case w.c:var a=e[t.hash],n=Object(F.a)(e,[t.hash].map(Z)),r=Object.assign({},a);return r.messages[X()(t.message)]=t.message,Object.assign({},Object(J.a)({},t.hash,r),n);default:return e}}var te=a(120),ae=[];function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.e:case x.g:return[].concat(Object(te.a)(e),[t.sub]);default:return e}}var re=[];function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return[].concat(Object(te.a)(e),[t.error]);case T:return e.filter(function(e){return e!==t.error});default:return e}}var se=function(e){return Object(h.c)({router:Object(m.b)(e),app:I,account:q,settings:H,contacts:$,chats:ee,subscriptions:ne,errors:ce})},ie=a(10),oe=a(14),le=a(152),ue=a.n(le),pe=a(153),de=a.n(pe),me=function(){function e(t){Object(ie.a)(this,e),this.key=t,this.trackFields=["account.username","settings.pss","settings.bzz","settings.revealAddress","contacts","chats"],this.excludeActionTypes=["ACCOUNT_REQUEST","ACCOUNT_RECEIVE","CONTACTS_RESTORE","CONTACT_SUBSCRIBE","CHATS_RESTORE","CHAT_SUBSCRIBE"]}return Object(oe.a)(e,[{key:"middleware",value:function(){var e=this,t=function(e,t){for(var a=t.split("."),n=e,r=0;r<a.length;r++){var c=a[r];if(!Object.hasOwnProperty.call(n,c))return;n=n[c]}return n},a=function(a){var n=a.settings,r=n.pss,c=n.bzz,s=n.revealAddress,i=Object(W.a)({},e.unpack(a.app.raw),{pss:r,bzz:c,revealAddress:s}),o=t(a,"account.publicKey");if(o){var l=t(a,"account.username");i[o]={username:l,contacts:a.contacts,chats:a.chats}}var u=ue.a.pack(i),p=de.a.compress(u);localStorage.setItem(e.key,p)};return function(n){return function(r){return function(){var c=Object(j.a)(O.a.mark(function c(s){var i,o;return O.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=n.getState(),c.next=3,r(s);case 3:if(s.type&&!e.excludeActionTypes.includes(s.type)){c.next=5;break}return c.abrupt("return");case 5:o=n.getState(),e.trackFields.some(function(e){return t(i,e)!==t(o,e)})&&a(o);case 8:case"end":return c.stop()}},c)}));return function(e){return c.apply(this,arguments)}}()}}}},{key:"deriveInitialState",value:function(e){var t=localStorage.getItem(this.key),a=this.unpack(t),n=e.settings,r=Object(F.a)(e,["settings"]),c=n.pss;return Object(W.a)({app:Object(W.a)({},a,{raw:t}),settings:Object(W.a)({},n,{isPssLocked:!!c,pss:c||a.pss||L.pss,bzz:a.bzz||L.bzz,revealAddress:void 0===a.revealAddress?L.revealAddress:a.revealAddress,size:(t||"").length})},r)}},{key:"unpack",value:function(e){var t=de.a.decompress(e);return t?ue.a.unpack(t):{}}}]),e}(),be=a(91),fe=a(155),he=a(18),ve=a(16),ge=a(17),ye=a(28),Ee=a(374),Oe=a(55),je=a(369),ke=a(372),xe=a(331),we=a(332),Ce=function(e){function t(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this))).url=e,a.reconnectInterval=n,a.resultSelector=r,a.serializer=c,a.defaultResultSelector=function(e){return JSON.parse(e.data)},a.defaultSerializer=function(e){return JSON.stringify(e)},a.connectionStatus=new ye.a(function(e){a.connectionObserver=e}).pipe(Object(ke.a)()).pipe(Object(xe.a)()),r||(a.resultSelector=a.defaultResultSelector),a.serializer||(a.serializer=a.defaultSerializer),a.wsSubjectConfig={url:e,closeObserver:{next:function(e){a.socket=null,a.connectionObserver.next(!1)}},openObserver:{next:function(e){a.connectionObserver.next(!0)}}},a.connect(),a.connectionStatus.subscribe(function(e){a.reconnectionObservable||"boolean"!=typeof e||e||a.reconnect()}),a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"connect",value:function(){var e=this;this.socket=new je.a(this.wsSubjectConfig),this.socket.subscribe(function(t){e.next(t)},function(t){e.socket||e.reconnect()})}},{key:"reconnect",value:function(){var e=this;this.reconnectionObservable=Object(Ee.a)(this.reconnectInterval).pipe(Object(we.a)(function(){return!e.socket})),this.reconnectionObservable.subscribe(function(){e.connect()},null,function(){e.reconnectionObservable=null,e.socket||(e.complete(),e.connectionObserver.complete())})}},{key:"send",value:function(e){this.socket.next(this.serializer(e))}}]),t}(Oe.b),Te=function e(t){Object(ie.a)(this,e);var a=t.bzz,n=t.ws;this.subject=new Ce(n),this.client=new be.SwarmClient({bzz:a,rpc:new fe.a(this.subject.socket)});var r=this;this.subject.connectionStatus.subscribe(function(e){e&&(r.client=new be.SwarmClient({bzz:a,rpc:new fe.a(r.subject.socket)}))})},Ne=Object(g.a)();var Se=a(37),Ae=a(114),ze=a(368),_e=a(48),Pe=a.n(_e),Ke=a(375),Re=a(343),Be=a(344),Ie=a(67),We=a(124),De=a(35),qe=a(299),Le=a(336),Ue=a(201),Me=a(337),He=a(339),Fe=a(338),Ve=a(340),Ge=a(4),$e=a(186),Je=a.n($e);var Qe=Object(Ge.a)({icon:{overflow:"hidden",borderRadius:"50%"}})(function(e){var t=e.classes,a=e.publicKey,n=e.size,c=e.style;return r.a.createElement("div",{className:t.icon,style:Object(W.a)({width:n,height:n},c)},r.a.createElement(Je.a,{seed:a,size:8,scale:Math.ceil(n/8)}))}),Xe=function(e){function t(){var e,a;Object(ie.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(he.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={anchorEl:null},a.handleMenu=function(e){a.setState({anchorEl:e.currentTarget})},a.handleClose=function(){a.setState({anchorEl:null})},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.dispatch,n=e.account,c=e.errors,s=this.state.anchorEl,i=Boolean(s);if(c.length)return r.a.createElement(Se.a,{to:"/settings"});var o=n.publicKey,l=n.username;return o?r.a.createElement(r.a.Fragment,null,r.a.createElement(qe.a,{"aria-owns":i?"menu-account":void 0,"aria-haspopup":"true",onClick:this.handleMenu,color:"inherit"},r.a.createElement(Qe,{publicKey:o,size:32})),r.a.createElement(Ue.a,{id:"menu-account",anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:i,onClose:this.handleClose},r.a.createElement(Le.a,{className:t.menu,onClick:function(){a(Object(De.d)("/profile"))}},r.a.createElement(Me.a,null,r.a.createElement(Fe.a,null)),r.a.createElement(He.a,{primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},l||o)})),r.a.createElement(Le.a,{onClick:function(){a(Object(De.d)("/settings"))}},r.a.createElement(Me.a,null,r.a.createElement(Ve.a,null)),r.a.createElement(He.a,{primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},"Settings")})))):null}}]),t}(n.Component),Ze=Object(h.d)(Object(d.c)(function(e){var t=e||{account:{publicKey:"",username:""},errors:[]};return{account:t.account,errors:t.errors}}),Pe()(function(e){return{menu:{maxWidth:300}}}))(Xe),Ye=a(341),et=a(342),tt="/messenger/control";var at=Object(h.d)(Object(d.c)(function(e){return{router:(e||{router:{location:{}}}).router}}))(function(e){var t=e.router,a=e.dispatch,n=t.location;return r.a.createElement(r.a.Fragment,null,n.pathname===tt?r.a.createElement(qe.a,{edge:"start",color:"inherit","aria-label":"Close",onClick:function(){a(De.e.goBack())}},r.a.createElement(Ye.a,null)):r.a.createElement(qe.a,{edge:"start",color:"inherit","aria-label":"Control panel",onClick:function(){a(Object(De.d)(tt))}},r.a.createElement(et.a,null)))}),nt=a(190),rt=a.n(nt);var ct=Object(h.d)(Object(d.c)(),Pe()(function(e){return{grow:{flexGrow:1},title:{color:"inherit",lineHeight:"2.4rem"},logo:{width:36,marginRight:e.spacing(2),display:"block",float:"left"}}}))(function(e){var t=e.classes,a=e.dispatch,n=e.isNarrow;return r.a.createElement(Re.a,{color:"default"},r.a.createElement(Be.a,null,n&&r.a.createElement(at,null),r.a.createElement(Ie.a,{variant:"h5",color:"inherit",noWrap:!0,className:t.grow},r.a.createElement(We.a,{className:t.title,style:{textDecoration:"none"},onClick:function(){a(Object(De.d)("/"))}},r.a.createElement("img",{src:rt.a,alt:"Nebula",className:t.logo}),r.a.createElement(Ie.a,{variant:"h5",color:"inherit",noWrap:!0},"Nebula"))),r.a.createElement(Ze,null)))}),st=a(345),it=a(191),ot=a.n(it),lt=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.errors;return r.a.createElement("div",{className:a.fixed},n.map(function(t,n){return r.a.createElement(st.a,{key:n,className:a.error,message:t,action:[r.a.createElement(qe.a,{key:"close","aria-label":"Close",color:"inherit",onClick:function(){return e.dismiss(t)}},r.a.createElement(ot.a,{className:a.icon}))]})}))}},{key:"dismiss",value:function(e){this.props.dispatch(function(e){return function(){var t=Object(j.a)(O.a.mark(function t(a){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:T,error:e});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}(e))}}]),t}(n.Component),ut=Object(h.d)(Object(d.c)(function(e){return{errors:(e||[]).errors}}),Object(Ge.a)(function(e){return{fixed:{position:"fixed",top:0,left:"50%",right:"auto",zIndex:1400,transform:"translateX(-50%)"},error:{backgroundColor:e.palette.error.dark}}}))(lt),pt=a(192),dt=a.n(pt),mt=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).state={isOpen:!1},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"componentWillUpdate",value:function(e){var t=this;this.props.isConnected||!e.isConnected||this.state.isOpen||(this.setState({isOpen:!0}),setTimeout(function(){t.setState({isOpen:!1})},3e3))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isStarted,n=e.isConnected,c=e.children,s=e.location.pathname;return a&&!n&&"/settings"!==s?r.a.createElement(Se.a,{to:"/settings"}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:t.fixed},this.state.isOpen&&r.a.createElement(st.a,{className:t.success,message:"Connected"}),!n&&r.a.createElement(st.a,{className:t.error,message:"No connection"})),c)}}]),t}(n.Component),bt=Object(h.d)(Object(d.c)(function(e){return(e||{app:{isConnected:!1,isStarted:!1}}).app}),Object(Ge.a)(function(e){return{fixed:{position:"fixed",top:6,left:"50%",right:"auto",zIndex:1400,transform:"translateX(-50%)"},success:{backgroundColor:dt.a[600]},error:{backgroundColor:e.palette.error.dark}}}))(Object(Se.f)(mt));var ft=Pe()(function(e){return{layout:{height:"100%",paddingTop:64}}})(function(e){var t=e.classes,a=e.children,n=e.isNarrow;return r.a.createElement(bt,null,r.a.createElement(Ke.a,null),r.a.createElement(ct,{isNarrow:n}),r.a.createElement("main",{className:t.layout},a),r.a.createElement(ut,null))}),ht=a(346),vt=a(156),gt=a(370),yt=a(349),Et=a(350),Ot=a(194),jt=a.n(Ot),kt=a(193),xt=a.n(kt),wt=a(154),Ct=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).reset=function(){a.props.dispatch(function(){var e=Object(j.a)(O.a.mark(function e(t){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:U,settings:{pss:L.pss,bzz:L.bzz,revealAddress:L.revealAddress}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},a.save=function(){var e=Object.assign({},a.props.settings,a.state),t=e.pss,n=e.bzz,r=e.revealAddress;a.props.dispatch(function(e){var t=e.pss,a=e.bzz,n=e.revealAddress;return function(){var e=Object(j.a)(O.a.mark(function e(r){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r({type:U,settings:{pss:t,bzz:a,revealAddress:n}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}({pss:t,bzz:n,revealAddress:r}))},a.state={},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.settings,c=t.app;return n.pss?r.a.createElement(ht.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(ht.a,{item:!0,md:6,sm:8,xs:11},!c.isConnected&&r.a.createElement(st.a,{className:a.info,message:r.a.createElement("div",null,"There is no connection. Make sure you did everything right in order to ",r.a.createElement("a",{href:"https://github.com/okamilab/nebula#running-nebula",target:"_block"},"run nebula"))}),r.a.createElement(Ie.a,{variant:"h5",color:"inherit",noWrap:!0,className:a.sectionTitle},"Settings"),r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"General"),r.a.createElement(vt.a,{square:!0,className:a.section},r.a.createElement(ht.a,{container:!0,spacing:0},r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"PSS endpoint (WebSocket)")),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(gt.a,{id:"pss",onChange:function(t){return e.setState({pss:t.target.value})},defaultValue:n.pss,disabled:n.isPssLocked})),r.a.createElement(ht.a,{item:!0,xs:12},r.a.createElement(Ie.a,{variant:"caption"},"After updating the field you need to restart the app (refresh page)")),r.a.createElement(ht.a,{item:!0,xs:12,className:a.divider},r.a.createElement(yt.a,null)),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"BZZ endpoint")),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(gt.a,{id:"bzz",onChange:function(t){return e.setState({bzz:t.target.value})},defaultValue:n.bzz})),r.a.createElement(ht.a,{item:!0,xs:12},r.a.createElement(Ie.a,{variant:"caption"},"After updating the field you need to restart the app (refresh page)")),r.a.createElement(ht.a,{item:!0,xs:12,className:a.divider},r.a.createElement(yt.a,null)),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Local storage")),r.a.createElement(ht.a,{item:!0,xs:6},xt()(n.size)))),r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"Security"),r.a.createElement(vt.a,{square:!0,className:a.section},r.a.createElement(ht.a,{container:!0,spacing:0},r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Reveal address partially")),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(gt.a,{id:"revealAddress",select:!0,onChange:function(t){return e.setState({revealAddress:+t.target.value})},value:void 0===this.state.revealAddress?n.revealAddress:this.state.revealAddress},r.a.createElement(Le.a,{value:0},"Broadcast"),r.a.createElement(Le.a,{value:4},"4"),r.a.createElement(Le.a,{value:8},"8"),r.a.createElement(Le.a,{value:16},"16"),r.a.createElement(Le.a,{value:32},"Full"))))),r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"About"),r.a.createElement(vt.a,{square:!0,className:a.section},r.a.createElement(ht.a,{container:!0,spacing:0},r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(Ie.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Version")),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement("a",{href:"https://github.com/okamilab/nebula/releases/tag/v".concat(wt.version),target:"_block"},wt.version)))),r.a.createElement("div",{className:a.actionBar},r.a.createElement(Et.a,{variant:"contained",onClick:this.reset,className:a.button},"Reset"),r.a.createElement(Et.a,{variant:"contained",color:"primary",onClick:this.save,className:a.button},"Save")))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),Tt=Object(h.d)(Object(d.c)(function(e){var t=e||{settings:{pss:L.pss,bzz:L.bzz,isPssLocked:!1,revealAddress:L.revealAddress,size:0},app:{isConnected:!1}};return{settings:t.settings,app:t.app}}),Object(Ge.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,padding:e.spacing(2)},divider:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},actionBar:{paddingTop:e.spacing(2)},button:{marginRight:e.spacing(2)},info:{backgroundColor:jt.a[300],color:"#000",maxWidth:"100%"}}}))(Ct),Nt=a(34),St=a(195),At=a(348),zt=a(347),_t=a(377),Pt=a(351),Kt=a(376),Rt=a(352),Bt=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).state={tooltipOpen:!1,copied:!1},a.toggle=a.toggle.bind(Object(Nt.a)(Object(Nt.a)(a))),a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"toggle",value:function(){this.setState({tooltipOpen:!this.state.tooltipOpen,copied:this.state.tooltipOpen})}},{key:"render",value:function(){var e=this,t=this.props,a=t.name,n=t.value,c=t.label,s=t.classes;if(!n||!n.length)return null;var i=n.length>22?"".concat(n.substr(0,16),"...").concat(n.substr(n.length-4)):n;return r.a.createElement(At.a,{margin:"normal"},r.a.createElement(_t.a,{htmlFor:"".concat(a,"_key")},c),r.a.createElement(zt.a,{id:"".concat(a,"_key"),type:"text",value:i,disabled:!0,className:s.input,endAdornment:r.a.createElement(Pt.a,{position:"end"},r.a.createElement(St.CopyToClipboard,{id:"".concat(a,"_key"),text:n,onCopy:function(){return e.setState({copied:!0})}},r.a.createElement(Kt.a,{title:this.state.copied?"Copied":"Copy to clipboard",placement:"right",onClose:function(){setTimeout(function(){return e.setState({copied:!1})},200)}},r.a.createElement(qe.a,null,r.a.createElement(Rt.a,{fontSize:"small"})))))}))}}]),t}(n.Component),It=Object(Ge.a)({input:{"&:before":{borderBottomStyle:"none!important"}}})(Bt),Wt=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).save=Object(j.a)(O.a.mark(function e(){var t,n;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.assign({},a.props,a.state),n=t.username,e.next=3,a.props.dispatch(_(n));case 3:case"end":return e.stop()}},e)})),a.state={},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.account,n=t.classes;if(!a)return r.a.createElement("div",null,"Loading");var c=a.username,s=a.publicKey,i=a.overlayAddress;return s?r.a.createElement(ht.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(ht.a,{item:!0,md:6,sm:8,xs:11},r.a.createElement(Ie.a,{variant:"h5",color:"inherit",noWrap:!0,className:n.sectionTitle},"Profile"),r.a.createElement(vt.a,{square:!0,className:n.section},r.a.createElement(ht.a,{container:!0,spacing:0},r.a.createElement(ht.a,{item:!0,xs:3},s?r.a.createElement(Qe,{publicKey:s,size:78}):null),r.a.createElement(ht.a,{item:!0,xs:6},r.a.createElement(gt.a,{id:"username",label:"User name",onChange:function(t){return e.setState({username:t.target.value})},defaultValue:c})),r.a.createElement(ht.a,{item:!0,xs:3},r.a.createElement(Et.a,{variant:"contained",color:"primary",onClick:this.save,className:n.button,disabled:!this.state.username},"Save")),r.a.createElement(ht.a,{item:!0,xs:3}),r.a.createElement(ht.a,{item:!0,xs:9},r.a.createElement(It,{name:"publicKey",value:s,label:"Public key"})),r.a.createElement(ht.a,{item:!0,xs:3}),r.a.createElement(ht.a,{item:!0,xs:9},r.a.createElement(It,{name:"overlayAddress",value:i,label:"Overlay address"})))))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),Dt=Object(h.d)(Object(d.c)(function(e){return{account:(e||{account:{publicKey:"",username:""}}).account}}),Object(Ge.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,marginTop:e.spacing(2),padding:e.spacing(2)},button:{marginTop:e.spacing(2)}}}))(Wt),qt=a(363),Lt=a(365),Ut=a(362),Mt=a(366),Ht=a(335),Ft=a(300),Vt=a(364),Gt=a(301),$t=a(353),Jt=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.list,a=e.title,n=e.renderItem;if(!t||!t.length)return null;var c=t.map(n);return r.a.createElement(Ht.a,{subheader:r.a.createElement($t.a,null,a)},c)}}]),t}(n.Component);Jt.defaultProps={renderItem:function(e,t){return r.a.createElement(Ft.a,{key:t,button:!0},r.a.createElement(He.a,{disableTypography:!0,primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},e.key)}))}};var Qt=Pe()(function(e){return{}})(Jt),Xt=a(373),Zt=a(357),Yt=a(355),ea=a(356),ta=a(354),aa=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).accept=function(){var e=a.props,t=e.publicKey,n=e.address;(0,e.dispatch)(Object(x.h)(t,n)),a.toggle()},a.decline=function(){var e=a.props,t=e.publicKey,n=e.address;(0,e.dispatch)(Object(x.i)(t,n)),a.toggle()},a.state={modal:!1},a.toggle=a.toggle.bind(Object(Nt.a)(Object(Nt.a)(a))),a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"toggle",value:function(){this.setState({modal:!this.state.modal})}},{key:"render",value:function(){var e=this.props.publicKey;return r.a.createElement(Ft.a,{button:!0,onClick:this.toggle},r.a.createElement(He.a,{disableTypography:!0,primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},e)}),r.a.createElement(Xt.a,{open:this.state.modal,onClose:this.toggle,"aria-labelledby":"form-dialog-title"},r.a.createElement(ta.a,{id:"form-dialog-title"},"Received contact"),r.a.createElement(Yt.a,null,r.a.createElement(ea.a,null,r.a.createElement(Ie.a,{noWrap:!0},"Do you want to accept request from ",e,"?"))),r.a.createElement(Zt.a,null,r.a.createElement(Et.a,{onClick:this.decline,color:"default"},"Decline"),r.a.createElement(Et.a,{onClick:this.accept,variant:"contained",color:"primary"},"Accept"))))}}]),t}(n.Component),na=Object(h.d)(Object(d.c)())(aa),ra=a(69),ca=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.contacts,a=e.dispatch,n=Object(ra.b)(Object.values(t),"type");return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qt,{list:n.sent_request,title:"Sent"}),r.a.createElement(Qt,{list:n.received_request,title:"Received",renderItem:function(e,t){return r.a.createElement(na,{key:t,publicKey:e.key,address:e.address})}}),r.a.createElement(Qt,{list:n.added,title:"Contacts",renderItem:function(e,t){return r.a.createElement(Ft.a,{key:t,button:!0,onClick:function(){a(Object(De.d)("/messenger/contact/".concat(X()(e.key))))}},r.a.createElement(Me.a,null,r.a.createElement(Qe,{publicKey:e.key,size:32})),r.a.createElement(He.a,{disableTypography:!0,primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},e.username||e.key)}))}}))}}]),t}(n.Component),sa=Object(h.d)(Object(d.c)(function(e){return{contacts:(e||{}).contacts}}),Object(Ge.a)(function(e){return{}}))(ca),ia=a(358),oa=a(359),la=a(360),ua=a(361),pa=Object(Ge.a)({root:{border:"none",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(ia.a),da=Object(Ge.a)({root:{padding:0,minHeight:56,"&$expanded":{minHeight:56}},content:{margin:"10px 0 20px",position:"relative","&::after":{content:"''",position:"absolute",bottom:0,left:0,right:0,height:"0.5em",borderTop:"1px solid #ddd"},"&$expanded":{margin:"12px 0"}},expanded:{}})(oa.a),ma=Object(Ge.a)(function(e){return{root:{padding:0}}})(la.a),ba=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).invite=Object(j.a)(O.a.mark(function e(){var t,n,r;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.state,n=t.publicKey,r=t.address,a.setState({error:null}),e.next=5,a.props.dispatch(Object(x.j)(n,r));case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),a.setState({error:e.t0.message}),e.abrupt("return");case 11:a.toggle();case 12:case"end":return e.stop()}},e,null,[[0,7]])})),a.state={modal:!1,publicKey:"",address:"",error:""},a.toggle=a.toggle.bind(Object(Nt.a)(Object(Nt.a)(a))),a.onKeyPress=a.onKeyPress.bind(Object(Nt.a)(Object(Nt.a)(a))),a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"toggle",value:function(e){e&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),this.setState({error:null,modal:!this.state.modal})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.state.publicKey&&this.invite()}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state.error;return r.a.createElement(r.a.Fragment,null,r.a.createElement(qe.a,{color:"inherit",onClick:this.toggle},r.a.createElement(ua.a,null)),r.a.createElement(Xt.a,{open:this.state.modal,onClose:this.toggle,"aria-labelledby":"form-dialog-title",fullWidth:!0,maxWidth:"sm"},r.a.createElement(ta.a,{id:"form-dialog-title"},"Invite contact"),r.a.createElement(Yt.a,null,r.a.createElement(ea.a,null,a?r.a.createElement(st.a,{message:a.message||a,className:t.error}):null),r.a.createElement(gt.a,{autoFocus:!0,margin:"dense",label:"Public key or Address or ENS *",type:"text",fullWidth:!0,onChange:function(t){return e.setState({publicKey:t.target.value})},onKeyPress:this.onKeyPress}),r.a.createElement(pa,null,r.a.createElement(da,{expandIcon:r.a.createElement(Ut.a,null)},r.a.createElement("span",{className:t.title},"Advanced")),r.a.createElement(ma,null,r.a.createElement(gt.a,{margin:"dense",label:"Overlay address",type:"text",fullWidth:!0,onChange:function(t){return e.setState({address:t.target.value})},onKeyPress:this.onKeyPress})))),r.a.createElement(Zt.a,null,r.a.createElement(Et.a,{onClick:this.toggle,color:"default"},"Cancel"),r.a.createElement(Et.a,{onClick:this.invite,disabled:!this.state.publicKey,variant:"contained",color:"primary"},"Send request"))))}}]),t}(n.Component),fa=Object(h.d)(Object(d.c)(),Object(Ge.a)(function(e){return{error:{backgroundColor:e.palette.error.dark},title:{padding:"0 10px",color:"#bbb",fontSize:"14px",background:"#fff",zIndex:10}}}))(ba),ha=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.chats,a=e.dispatch;return r.a.createElement(Ht.a,{component:"div",disablePadding:!0},Object.values(t).map(function(e,t){return r.a.createElement(Ft.a,{key:t,button:!0,onClick:function(){a(Object(De.d)("/messenger/chat/".concat(X()(e.key))))}},r.a.createElement(Me.a,null,r.a.createElement(Qe,{publicKey:e.key,size:32})),r.a.createElement(He.a,{disableTypography:!0,primary:r.a.createElement(Ie.a,{color:"inherit",noWrap:!0},e.key)}))}))}}]),t}(n.Component),va=Object(h.d)(Object(d.c)(function(e){return{chats:(e||{}).chats}}),Pe()(function(e){return{}}))(ha),ga=function(e){function t(){var e,a;Object(ie.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(he.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={isContactsOpen:!0,isChatsOpen:!0},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Ht.a,{component:"nav"},r.a.createElement(Ft.a,{button:!0,onClick:function(){e.setState({isContactsOpen:!e.state.isContactsOpen})}},r.a.createElement(Me.a,null,r.a.createElement(qt.a,null)),r.a.createElement(He.a,{primary:"Contacts"}),r.a.createElement(Vt.a,{style:{paddingRight:20}},r.a.createElement(fa,null)),r.a.createElement("span",null,this.state.isContactsOpen?r.a.createElement(Lt.a,null):r.a.createElement(Ut.a,null))),r.a.createElement(Gt.a,{in:this.state.isContactsOpen,unmountOnExit:!0},r.a.createElement(sa,null)),r.a.createElement(Ft.a,{button:!0,onClick:function(){e.setState({isChatsOpen:!e.state.isChatsOpen})}},r.a.createElement(Me.a,null,r.a.createElement(Mt.a,null)),r.a.createElement(He.a,{primary:"Chats"}),this.state.isChatsOpen?r.a.createElement(Lt.a,null):r.a.createElement(Ut.a,null)),r.a.createElement(Gt.a,{in:this.state.isChatsOpen,unmountOnExit:!0},r.a.createElement(va,null)))}}]),t}(n.Component);var ya=Object(Ge.a)({root:{flexGrow:1,maxWidth:500,height:"100%"}})(function(e){var t=e.classes;return r.a.createElement(vt.a,{square:!0,className:t.root},r.a.createElement(ga,null))});var Ea=Pe()({container:{width:"100%",height:"100%",margin:0,padding:0},cell:{margin:0,padding:0,height:"100%"}})(function(e){var t=e.classes,a=e.children,n=e.isNarrow;return r.a.createElement(ht.a,{container:!0,spacing:0,className:t.container},!n&&r.a.createElement(ht.a,{item:!0,xs:3,className:t.cell},r.a.createElement(ya,null)),r.a.createElement(ht.a,{item:!0,xs:n?12:9,className:t.cell},a))}),Oa=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isNarrow,n=e.contact,c=e.dispatch;if(!n)return r.a.createElement("div",null,"Contact not found");var s=n.username,i=n.key,o=n.address;return i?r.a.createElement(Ea,{isNarrow:a},r.a.createElement(ht.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(ht.a,{item:!0,md:6,sm:8,xs:11},r.a.createElement(Ie.a,{variant:"h5",color:"inherit",noWrap:!0,className:t.sectionTitle},"Contact"),r.a.createElement(vt.a,{square:!0,className:t.section},r.a.createElement(ht.a,{container:!0,spacing:0},r.a.createElement(ht.a,{item:!0,xs:3},i?r.a.createElement(Qe,{publicKey:i,size:78}):null),r.a.createElement(ht.a,{item:!0,xs:9},r.a.createElement(gt.a,{id:"username",label:"User name",disabled:!0,defaultValue:s})),r.a.createElement(ht.a,{item:!0,xs:3}),r.a.createElement(ht.a,{item:!0,xs:9},r.a.createElement(It,{name:"publicKey",value:i,label:"Public key"})),r.a.createElement(ht.a,{item:!0,xs:3}),r.a.createElement(ht.a,{item:!0,xs:9},r.a.createElement(It,{name:"address",value:o,label:"Overlay address"})))),r.a.createElement("div",{className:t.actionBar},r.a.createElement(Et.a,{variant:"contained",color:"primary",className:t.button,onClick:function(){c(Object(De.d)("/messenger/chat/".concat(X()(i))))}},"Chat"))))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),ja=Object(h.d)(Object(d.c)(function(e,t){return{contact:(e||{}).contacts[t.match.params.key]}}),Object(Ge.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,marginTop:e.spacing(2),padding:e.spacing(2)},actionBar:{paddingTop:e.spacing(2)},button:{marginRight:e.spacing(2)}}}))(Oa),ka=a(123),xa=a(302),wa=a(367),Ca=Object(Ge.a)(function(e){return{divider:{textAlign:"center",borderBottom:"1px solid #ddd",lineHeight:"0.3em",margin:"10px 0 20px"},title:{background:e.palette.background.default,padding:"0 6px",color:"#bbb",fontSize:"12px"}}})(function(e){var t=e.classes,a=e.date;return r.a.createElement("div",{className:t.divider},r.a.createElement("span",{className:t.title},a.toLocaleDateString()))}),Ta=function(e){function t(){var e,a;Object(ie.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(he.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).download=function(e){e&&a.props.dispatch(Object(w.g)(e))},a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"renderMessageContent",value:function(){var e=this,t=this.props,a=t.classes,n=t.message,c=t.isOwn,s=n.text;switch(s.startsWith("bzz:/")){case!0:return r.a.createElement("div",{className:a.file},r.a.createElement("div",{className:a.fileName},"File: ",s.substr(5,15),"..."),r.a.createElement("hr",{className:a.divider}),r.a.createElement("div",{className:a.actionBar},r.a.createElement(Et.a,{onClick:function(){return e.download(s.substr(5))}},"Download")));default:return r.a.createElement("div",{className:"".concat(a.body," ").concat(c?a.ownedBody:null)},n.text)}}},{key:"renderMessage",value:function(){var e,t=this.props,a=t.classes,c=t.message,s=t.sender,i=t.isOwn,o=t.showHeader,l=new Date(c.timestamp);switch(i){case!0:return o&&(e=r.a.createElement("div",{className:a.header},l.toLocaleTimeString())),r.a.createElement(n.Fragment,null,e,this.renderMessageContent());default:var u=r.a.createElement("div",{style:{width:32}}),p=s.key,d=s.username;return o&&(u=r.a.createElement("div",null,r.a.createElement(Qe,{publicKey:p,size:32})),e=r.a.createElement("div",{className:a.header},d||"".concat(p.substr(0,8),"..."),", ",l.toLocaleTimeString())),r.a.createElement("div",{className:a.layout},u,r.a.createElement("div",{className:a.content},e,this.renderMessageContent()))}}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isOwn;return r.a.createElement("div",{className:"".concat(t.block," ").concat(a?t.owned:null)},this.renderMessage())}}]),t}(n.Component),Na=Object(h.d)(Object(d.c)(),Object(Ge.a)(function(e){return{file:{backgroundColor:"#f1f1f4",display:"inline-block",padding:10,borderRadius:6},fileName:{paddingTop:e.spacing(1)},divider:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},actionBar:{textAlign:"center",paddingBottom:e.spacing(1)},block:{textAlign:"left",paddingTop:2},owned:{textAlign:"right",paddingRight:10},layout:{display:"flex"},content:{paddingLeft:e.spacing(1)},header:{fontSize:12,color:"#bbb"},body:{backgroundColor:"#f2f6f9",display:"inline-block",padding:"2px 10px",marginRight:10,borderRadius:6,textAlign:"left"},ownedBody:{backgroundColor:"#dbf4fd",marginRight:0,marginLeft:40}}}))(Ta),Sa=function(e){function t(e){var a;return Object(ie.a)(this,t),(a=Object(he.a)(this,Object(ve.a)(t).call(this,e))).send=function(){var e=a.props.id;a.props.dispatch(Object(w.j)(e,a.state.msg)),a.setState({msg:""})},a.upload=function(e){if(e.target.files.length){var t=a.props.id;a.props.dispatch(Object(w.i)(t,e.target.files[0]))}},a.state={msg:""},a.onChange=a.onChange.bind(Object(Nt.a)(Object(Nt.a)(a))),a.onKeyPress=a.onKeyPress.bind(Object(Nt.a)(Object(Nt.a)(a))),a}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){ka.scroller.scrollTo("bottom",{duration:400,delay:0,smooth:"easeInOutQuart",containerId:"scroll-container"})}},{key:"onChange",value:function(e){this.setState({msg:e.target.value})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.state.msg&&this.send()}},{key:"isSameDay",value:function(e,t){return e.getDay()===t.getDay()}},{key:"showMsgHeader",value:function(e,t,a){return 0===e||t.sender!==a.sender}},{key:"getParticipants",value:function(){var e=this.props,t=e.chat,a=e.account,n=e.contacts,r=a.publicKey,c=Object(J.a)({},X()(r),{key:r});return Object.keys(t.participants).forEach(function(e){n[e]&&(c[e]=n[e])}),c}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,c=t.isNarrow,s=t.chat,i=t.account;if(!s)return r.a.createElement("div",null,"Chat not found");var o=this.getParticipants(),l=Object.values(s.messages).sort(function(e,t){return e.timestamp-t.timestamp}),u=i.publicKey;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ea,{isNarrow:c},r.a.createElement(ka.Element,{id:"scroll-container",className:a.scrollContainer},r.a.createElement(ht.a,{container:!0,spacing:0,justify:"center"},r.a.createElement(ht.a,{item:!0,xs:10,lg:10,xl:8,className:a.list},l.map(function(t,a){var c=o[t.sender],s=new Date(t.timestamp),i=0===a||!e.isSameDay(s,new Date(l[a-1].timestamp));return r.a.createElement(n.Fragment,{key:a},i?r.a.createElement(Ca,{date:s}):null,r.a.createElement("div",null,r.a.createElement(Na,{message:t,sender:c,isOwn:c.key===u,showHeader:e.showMsgHeader(a,t,a>0?l[a-1]:null)||i})))}),r.a.createElement(ka.Element,{name:"bottom"}))))),r.a.createElement("div",{className:a.fixed},r.a.createElement(ht.a,{container:!0,spacing:0},!c&&r.a.createElement(ht.a,{item:!0,sm:3}),r.a.createElement(ht.a,{item:!0,xs:c?12:9},r.a.createElement(ht.a,{container:!0,spacing:0,justify:"center"},r.a.createElement(ht.a,{item:!0,xs:10,lg:10,xl:8},r.a.createElement(vt.a,{className:a.root,elevation:1},r.a.createElement(xa.a,{className:a.input,placeholder:"Type a message here",value:this.state.msg,onChange:this.onChange,onKeyPress:this.onKeyPress,autoFocus:!0}),r.a.createElement(qe.a,{className:a.iconButton,onClick:this.send,disabled:!this.state.msg},r.a.createElement(wa.a,null)))))))))}}]),t}(n.Component),Aa=Object(h.d)(Object(d.c)(function(e,t){var a=e||{chats:[],account:{},contacts:{}},n=a.chats,r=a.account,c=a.contacts,s=t.match.params.key;return{id:s,chat:n[s],account:r,contacts:c}}),Object(Ge.a)(function(e){return{scrollContainer:{height:"100%",overflow:"scroll"},list:{paddingBottom:80},root:{marginTop:e.spacing(4),marginBottom:e.spacing(4),marginRight:e.spacing(2),padding:"2px 4px",display:"flex"},input:{marginLeft:8,flex:1},file:{width:.1,height:.1,opacity:0,overflow:"hidden",position:"absolute",zIndex:"-1",cursor:"pointer"},fileLabel:{margin:0},iconButton:{padding:10},divider:{width:1,height:28,marginTop:8,marginBottom:8,marginLeft:4,marginRight:4},fixed:{position:"fixed",left:0,right:0,bottom:0}}}))(Sa),za=function(e){function t(){return Object(ie.a)(this,t),Object(he.a)(this,Object(ve.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(oe.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)(function(){var e=Object(j.a)(O.a.mark(function e(t,a,n){return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:P}),n().connection.subscribe(function(e){e?(t({type:K}),t(function(){var e=Object(j.a)(O.a.mark(function e(t,a,n){var r,c,s,i,o,l,u,p,d;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:S}),e.prev=1,r=n(),c=r.client,e.next=5,Promise.all([c.pss.getPublicKey(),c.pss.baseAddr()]);case 5:s=e.sent,i=Object(k.a)(s,2),o=i[0],l=i[1],u=a(),p=u.app,d=p[o]||{},t((m={publicKey:o,overlayAddress:l,username:d.username},{type:A,account:m})),t(Object(x.k)(o)),t(Object(w.h)(o)),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t(N(e.t0.message));case 19:case"end":return e.stop()}var m},e,null,[[1,16]])}));return function(t,a,n){return e.apply(this,arguments)}}())):t({type:R})},function(e){t(N(e.message))});case 3:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}())}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.children)}}]),t}(r.a.Component),_a=Object(d.c)()(za);a(295);var Pa=Object(h.d)(Object(d.c)(function(e){return{settings:(e||{settings:{mode:"full",home:"/"}}).settings}}))(function(e){var t=e.settings,a=Object(Ae.a)(),n=!Object(ze.a)(a.breakpoints.up("md"))||"narrow"===t.mode;return r.a.createElement(_a,null,r.a.createElement(p.a,{titleTemplate:"Nebula - %s"}),r.a.createElement(ft,{isNarrow:n},r.a.createElement(Se.d,null,r.a.createElement(Se.b,{exact:!0,path:"/settings",component:Tt}),r.a.createElement(Se.b,{exact:!0,path:"/profile",component:Dt}),r.a.createElement(Se.b,{exact:!0,path:"/",render:function(e){return r.a.createElement(Ea,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(Se.b,{exact:!0,path:"/messenger/contact/:key",render:function(e){return r.a.createElement(ja,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(Se.b,{exact:!0,path:"/messenger/chat/:key",render:function(e){return r.a.createElement(Aa,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(Se.b,{exact:!0,path:"/messenger/control",render:function(e){return r.a.createElement(ga,Object.assign({},e,{isNarrow:n}))}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ka=a(198);o.a.config();var Ra=new URLSearchParams(window.location.search),Ba=f.a.create({baseURL:"https://ethertest-func.azurewebsites.net"}),Ia=function(e,t){var a=h.d,n=new me("nebula"),r={bzz:(e=n.deriveInitialState(e)).settings.bzz,ws:e.settings.pss},c=new Te(r),s=[Object(y.a)(Ne),n.middleware(),v.a.withExtraArgument(function(){return{client:c.client,connection:c.subject.connectionStatus,httpClient:t}})],i=[h.a.apply(void 0,s)];return Object(h.e)(se(Ne),e,a.apply(void 0,i))}({settings:{mode:"true"===(Ra.get("narrow")||"").toLowerCase()?"narrow":"full",home:Ra.get("home")||"/",pss:Ra.get("pss")||null}},Ba);s.a.render(r.a.createElement(l.AppContainer,null,r.a.createElement(u.HelmetProvider,null,r.a.createElement(d.a,{store:Ia},r.a.createElement(m.a,{history:Ne},r.a.createElement(Pa,null))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}),Object(Ka.run)(Ia)},33:function(e,t,a){"use strict";var n=a(84),r=a(5),c=a.n(r),s=a(25),i=a(32),o=a(12),l=a(91),u=a(202),p=a(298),d=a(24),m=a.n(d),b=/^0x[0-9a-f]{130}$/,f={isValidPubKey:function(e){return b.test(e)},validatePubKey:function(e,t){if(e===t)throw new Error("Invalid contact key: this is your own key");if(!b.test(e))throw new Error('Invalid contact key: must be an hexadecimal string prefixed with "0x"');return!0},ensurePrefix:function(e){return e&&e.startsWith("0x")&&(e=e.substr(2)),"0x"+(e=128===e.length?"04"+e:e)}},h=a(36),v=a(69);function g(e,t){return y.apply(this,arguments)}function y(){return(y=Object(o.a)(c.a.mark(function e(t,a){var n,r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/api/v0.1/publickeys/lookup?q=".concat(a));case 2:return n=e.sent,r=n.data,e.abrupt("return",r||{});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}a.d(t,"a",function(){return E}),a.d(t,"g",function(){return O}),a.d(t,"f",function(){return j}),a.d(t,"e",function(){return k}),a.d(t,"d",function(){return x}),a.d(t,"b",function(){return w}),a.d(t,"c",function(){return C}),a.d(t,"k",function(){return z}),a.d(t,"j",function(){return _}),a.d(t,"h",function(){return R}),a.d(t,"i",function(){return B});var E="CONTACTS_RESTORE",O="CONTACT_SUBSCRIBE",j="CONTACT_REQUEST",k="CONTACT_RECEIVE",x="CONTACT_MUTATE",w="CONTACT_ACCEPT",C="CONTACT_DECLINE";function T(e){return{key:e.key,data:e.msg.toObject()}}function N(e,t){return S.apply(this,arguments)}function S(){return(S=Object(o.a)(c.a.mark(function e(t,a){var n,r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pss.stringToTopic(a);case 2:return n=e.sent,e.next=5,t.pss.createTopicSubscription(n);case 5:return r=e.sent,e.abrupt("return",r.pipe(Object(u.a)(T),Object(p.a)(function(e){return"contact_request"===e.data.type&&null!=e.data.payload&&null!=e.data.payload.topic||"contact_response"===e.data.type}),Object(u.a)(function(e){return{key:e.key,type:e.data.type,payload:e.data.payload}})));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n){var r,o,l,u,p,d,b;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t(),o=r.contacts,l=m()(n.key),u=o[l],"contact_request"!==n.type||null!=u&&"received_request"!==u.type){a.next=8;break}p={key:n.key,type:"received_request",topic:n.payload.topic,username:n.payload.username,address:n.payload.overlay_address},e({type:k,contacts:Object(i.a)({},l,p)}),a.next=26;break;case 8:if("contact_request"!==n.type||null!=u&&"added"!==u.type&&"sent_request"!==u.type){a.next=14;break}d=Object(s.a)({},u,{topic:n.payload.topic,username:n.payload.username,address:n.payload.overlay_address}),e({type:x,contacts:Object(i.a)({},l,d)}),e(R(n.key,n.payload.overlay_address)),a.next=26;break;case 14:if("contact_response"!==n.type||!n.payload.contact||null==u||"sent_declined"!==u.type&&"sent_request"!==u.type){a.next=20;break}b=Object(s.a)({},u,{type:"added",username:n.payload.username,address:n.payload.overlay_address}),e({type:x,contacts:Object(i.a)({},l,b)}),e(Object(h.f)(b)),a.next=26;break;case 20:if("contact_response"!==n.type||n.payload.contact||null==u||"sent_declined"!==u.type&&"sent_request"!==u.type){a.next=24;break}e({type:C,hash:l}),a.next=26;break;case 24:return console.error("unhandled event",n),a.abrupt("return");case 26:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function z(e){return function(){var t=Object(o.a)(c.a.mark(function t(a,n){var r,s,i,l;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n(),s=r.app,i=s[e]||{},l=i.contacts||{},a({type:E,contacts:l}),a(function(){var e=Object(o.a)(c.a.mark(function e(t,a,n){var r,s,i,o,l,u;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a(),s=r.account,i=n(),o=i.client,e.next=4,N(o,s.publicKey);case 4:l=e.sent,u=l.subscribe(A(t,a)),t({type:O,sub:u});case 7:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}());case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function _(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(r,s,o){var u,p,d,b,h,y,E,O,k,x,w,C,T,N,S,A,z;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(u=o(),p=u.httpClient,d=u.client,b=e,f.isValidPubKey(b)){a.next=9;break}return a.next=5,g(p,e);case 5:if((h=a.sent)&&h.publicKey){a.next=8;break}throw new Error("Public key not found");case 8:b=f.ensurePrefix(h.publicKey);case 9:if(y=s(),E=y.account,O=y.contacts,k=y.settings,x=Object(l.hexValueType)(b),w=m()(x),f.validatePubKey(x,E.publicKey),!(C=O[w])||"received_request"!==C.type){a.next=17;break}return r(R(x,t)),a.abrupt("return");case 17:if(!C||"sent_request"===C.type){a.next=19;break}throw new Error("The contact already present in your list of contacts");case 19:return a.next=21,Promise.all([d.pss.stringToTopic(x),d.pss.stringToTopic(Math.random().toString(36).slice(2))]);case 21:return T=a.sent,N=Object(n.a)(T,2),S=N[0],A=N[1],a.next=27,d.pss.setPeerPublicKey(x,S,t||"0x");case 27:return z={type:"contact_request",payload:{username:E.username,message:null,topic:A,overlay_address:Object(v.a)(E.overlayAddress,k.revealAddress)},utc_timestamp:Date.now()},a.next=30,d.pss.sendAsym(x,S,z);case 30:r({type:j,contacts:Object(i.a)({},w,{key:x,topic:A,type:"sent_request"})});case 31:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function P(e,t,a,n,r){return K.apply(this,arguments)}function K(){return(K=Object(o.a)(c.a.mark(function e(t,a,n,r,i){var o,l,u,p,d,m;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pss.stringToTopic(n);case 2:if(o=e.sent,l={contact:i},!i){e.next=9;break}return u=a(),p=u.account,d=u.settings,l=Object(s.a)({},l,{username:p.username,overlay_address:Object(v.a)(p.overlayAddress,d.revealAddress)}),e.next=9,t.pss.setPeerPublicKey(n,o,r||"0x");case 9:return m={type:"contact_response",payload:l,utc_timestamp:Date.now()},e.next=12,t.pss.sendAsym(n,o,m);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function R(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n,r,o){var l,u,p,d,b,f;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return l=r(),u=l.contacts,p=o(),d=p.client,a.next=4,P(d,r,e,t,!0);case 4:b=m()(e),f=Object(s.a)({},u[b],{type:"added"}),n({type:w,contacts:Object(i.a)({},b,f)}),n(Object(h.f)(f));case 8:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function B(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n,r,s){var i,o,l;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=s(),o=i.client,a.next=3,P(o,r,e,t,!1);case 3:l=m()(e),n({type:C,hash:l});case 5:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}},36:function(e,t,a){"use strict";a.d(t,"a",function(){return f}),a.d(t,"b",function(){return h}),a.d(t,"e",function(){return v}),a.d(t,"d",function(){return g}),a.d(t,"c",function(){return y}),a.d(t,"h",function(){return T}),a.d(t,"f",function(){return N}),a.d(t,"j",function(){return z}),a.d(t,"i",function(){return _}),a.d(t,"g",function(){return P});var n=a(84),r=a(32),c=a(5),s=a.n(c),i=a(12),o=a(202),l=a(298),u=a(24),p=a.n(u),d=a(182),m=a.n(d),b=a(69),f="CHATS_RESTORE",h="CHAT_CREATE",v="CHAT_SUBSCRIBE",g="CHAT_SEND_MESSAGE",y="CHAT_RECEIVE_MESSAGE";function E(e){return{key:e.key,data:e.msg.toObject()}}function O(e,t){var a=t[e];if(!a)throw new Error("Chat is not found");return a}function j(e,t){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(s.a.mark(function e(t,a){var r,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.pss.createTopicSubscription(a.topic),t.pss.setPeerPublicKey(a.key,a.topic,a.address)]);case 2:return r=e.sent,c=Object(n.a)(r,1),i=c[0],e.abrupt("return",i.pipe(Object(o.a)(E),Object(l.a)(function(e){return"chat_message"===e.data.type&&null!=e.data.payload}),Object(o.a)(function(e){return{key:e.key,type:e.data.type,utc_timestamp:e.data.utc_timestamp,payload:e.data.payload}})));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n){var r,c,i,o,l;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t(),c=r.chats,i=p()(n.key),o=O(i,c),l={sender:i,isRead:!1,text:n.payload.text,timestamp:n.utc_timestamp},!o.messages[p()(l)]){a.next=7;break}return a.abrupt("return");case 7:e({type:y,hash:i,message:l});case 8:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function w(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n,r){var c,i,o,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=r(),i=c.client,t.next=3,j(i,e);case 3:o=t.sent,l=o.subscribe(x(a,n)),a({type:v,sub:l});case 6:case"end":return t.stop()}},t)}));return function(e,a,n){return t.apply(this,arguments)}}()}function C(e,t){Object.values(t).map(function(t){return e(w(t))})}function T(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n){var r,c,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n(),c=r.app,i=c[e]||{},o=i.chats||{},a({type:f,chats:o}),C(a,o);case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function N(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n){var c,i,o,l,u;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=n(),o=i.account,l=p()(e.key),u={key:e.key,topic:e.topic,address:e.address,participants:(c={},Object(r.a)(c,l,e.key),Object(r.a)(c,p()(o.publicKey),o.publicKey),c),messages:{}},a({type:h,chats:Object(r.a)({},l,u)}),a(w(u));case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function S(e,t,a,n,r){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(s.a.mark(function e(t,a,n,r,c){var i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={type:"chat_message",payload:{text:c},utc_timestamp:Date.now()},e.next=3,a.pss.sendAsym(n.key,n.topic,i);case 3:o={sender:p()(r),isRead:!0,timestamp:Date.now(),text:c},t({type:g,hash:p()(n.key),message:o});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n,r,c){var i,o,l,u,p,d;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=r(),o=i.account,l=i.chats,u=O(e,l),p=c(),d=p.client,S(n,d,u,o.publicKey,t);case 4:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function _(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n,r,c){var i,o,l,u,p,d,m,f,h,v,g;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=r(),o=i.account,l=i.chats,u=O(e,l),p=c(),d=p.client,m=d.bzz,a.next=6,Object(b.c)(t);case 6:return f=a.sent,h=f.currentTarget.result,a.next=10,m.uploadFile(h,{contentType:t.type});case 10:v=a.sent,g="bzz:/".concat(v),S(n,d,u,o.publicKey,g);case 13:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function P(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n,r){var c,i,o,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=r(),i=c.client,o=i.bzz,t.next=4,o.download(e);case 4:return l=t.sent,t.t0=m.a,t.next=8,l.blob();case 8:return t.t1=t.sent,t.next=11,t.t0.saveAs.call(t.t0,t.t1);case 11:case"end":return t.stop()}},t)}));return function(e,a,n){return t.apply(this,arguments)}}()}},69:function(e,t,a){"use strict";a.d(t,"b",function(){return n}),a.d(t,"c",function(){return r}),a.d(t,"a",function(){return c});var n=function(e,t){return e.reduce(function(e,a){return(e[a[t]]=e[a[t]]||[]).push(a),e},{})},r=function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=t,n.readAsArrayBuffer(e)})},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.substring(0,2+2*t)||"0x"}}},[[218,1,2]]]);
//# sourceMappingURL=main.c962b0d4.chunk.js.map