(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{151:function(e){e.exports={name:"nebula",version:"0.1.6",private:!0,homepage:".",dependencies:{"@erebos/api-pss":"0.5.3","@erebos/swarm-browser":"0.5.3","@mainframe/rpc-stream":"0.3.0","@material-ui/core":"4.2.0","@material-ui/icons":"4.2.1","@material-ui/styles":"4.2.0","connected-react-router":"6.5.2","file-saver":"2.0.0","hash-sum":"1.0.2",jsonpack:"1.1.5","lz-string":"1.4.4",prettysize:"2.0.0","prop-types":"15.6.2",react:"16.8.6","react-blockies":"1.4.0","react-copy-to-clipboard":"5.0.1","react-dom":"16.8.6","react-helmet-async":"0.2.0","react-hot-loader":"4.6.3","react-jobs":"1.0.1","react-redux":"7.1.0","react-router":"5.0.1","react-scripts":"2.1.8","react-scroll":"1.7.10",redux:"4.0.4","redux-thunk":"2.3.0",rxjs:"6.4.0"},devDependencies:{eslint:"5.12.0","eslint-plugin-react-hooks":"1.5.1",hasky:"3.0.2","release-it":"10.3.1"},scripts:{start:"react-scripts start",build:"react-scripts build",test:"react-scripts test",eject:"react-scripts eject",lint:"eslint --ext .jsx,.js --max-warnings 0 src",release:"release-it --no-npm.publish"},browserslist:[">0.2%","not dead","not ie <= 11","not op_mini all"],husky:{hooks:{"pre-commit":"npm run lint"}}}},163:function(e,t){},174:function(e,t,a){e.exports=a.p+"static/media/logo.1584bb37.svg"},181:function(e,t,a){"use strict";a.d(t,"run",function(){return s});var n=a(25),r=a(182),c=(a(163),Object(n.a)({},r.a));function s(e){window.addEventListener("message",function(t){return function(e,t){if(t||t.type){if(c[t.type])return c[t.type](e,t);console.error("Nebula::Handler not found")}else console.error("Nebula::Message is invalid")}(e,t.data)},!1),console.log("Nebula::APIs started")}},182:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var n=a(31),r=a(35),c=a(24),s=a.n(c),i=a(32);var o=Object(n.a)({},"@NEBULA::CHAT_OPEN",function(e,t){var a=t.publicKey,n=e.dispatch,c=(0,e.getState)(),o=s()(a);c.chats[o]?n(Object(r.d)("/messenger/chat/".concat(o))):n(Object(i.j)(a))})},201:function(e,t,a){e.exports=a(265)},216:function(e,t,a){},263:function(e,t,a){},265:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(20),s=a.n(c),i=a(183),o=a(101),l=a.n(o),u=a(11),p=a(45),d=(a(216),a(10)),m=a(165),b=a(58),f=a(158),h=a(5),v=a.n(h),g=a(13),y=a(82),E=a(32),O=a(36),j="ERROR_CATCHED",k="ERROR_DISMISS";function x(e){return function(){var t=Object(g.a)(v.a.mark(function t(a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:j,error:e});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var w="ACCOUNT_REQUEST",C="ACCOUNT_RECEIVE",T="ACCOUNT_MUTATE";function N(e){return function(){var t=Object(g.a)(v.a.mark(function t(a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:T,account:{username:e}});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var S="APP_CONNECTING",A="APP_CONNECTED",z="APP_DISCONNECTED";var _={isStarted:!1,isConnected:!1,raw:""};function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;switch((arguments.length>1?arguments[1]:void 0).type){case A:return Object.assign({},e,{isStarted:!0,isConnected:!0});case z:return Object.assign({},e,{isStarted:!0,isConnected:!1});default:return e}}var K=a(25),R={isLoading:!1,publicKey:"",overlayAddress:"",username:""};function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object.assign({},e,{isLoading:!0});case C:return Object.assign({},e,Object(K.a)({isLoading:!1},t.account));case T:return Object.assign({},e,Object(K.a)({},t.account));default:return e}}var I={pss:"ws://127.0.0.1:8546",bzz:"http://127.0.0.1:8500",revealAddress:4},W="SETTINGS_MUTATE";var D={bzz:"",pss:"",revealAddress:0,size:0,mode:"full",home:"/"};function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return Object.assign({},e,Object(K.a)({},t.settings));default:return e}}var L=a(83);function M(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var U={};function F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E.a:case E.f:case E.e:case E.d:case E.b:return Object.assign({},e,Object(K.a)({},t.contacts));case E.c:e[t.hash];var a=Object(L.a)(e,[t.hash].map(M));return Object.assign({},a);default:return e}}var H=a(31),V=a(24),G=a.n(V);function J(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var Q={};function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O.a:case O.b:return Object.assign({},e,Object(K.a)({},t.chats));case O.d:case O.c:var a=e[t.hash],n=Object(L.a)(e,[t.hash].map(J)),r=Object.assign({},a);return r.messages[G()(t.message)]=t.message,Object.assign({},Object(H.a)({},t.hash,r),n);default:return e}}var Z=a(118),$=[];function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O.e:case E.g:return[].concat(Object(Z.a)(e),[t.sub]);default:return e}}var ee=[];function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return[].concat(Object(Z.a)(e),[t.error]);case k:return e.filter(function(e){return e!==t.error});default:return e}}var ae=function(e){return Object(d.c)({router:Object(p.b)(e),app:P,account:B,settings:q,contacts:F,chats:X,subscriptions:Y,errors:te})},ne=a(9),re=a(12),ce=a(149),se=a.n(ce),ie=a(150),oe=a.n(ie),le=function(){function e(t){Object(ne.a)(this,e),this.key=t,this.trackFields=["account.username","settings.pss","settings.bzz","settings.revealAddress","contacts","chats"],this.excludeActionTypes=["ACCOUNT_REQUEST","ACCOUNT_RECEIVE","CONTACTS_RESTORE","CONTACT_SUBSCRIBE","CHATS_RESTORE","CHAT_SUBSCRIBE"]}return Object(re.a)(e,[{key:"middleware",value:function(){var e=this,t=function(e,t){for(var a=t.split("."),n=e,r=0;r<a.length;r++){var c=a[r];if(!Object.hasOwnProperty.call(n,c))return;n=n[c]}return n},a=function(a){var n=a.settings,r=n.pss,c=n.bzz,s=n.revealAddress,i=Object(K.a)({},e.unpack(a.app.raw),{pss:r,bzz:c,revealAddress:s}),o=t(a,"account.publicKey");if(o){var l=t(a,"account.username");i[o]={username:l,contacts:a.contacts,chats:a.chats}}var u=se.a.pack(i),p=oe.a.compress(u);localStorage.setItem(e.key,p)};return function(n){return function(r){return function(){var c=Object(g.a)(v.a.mark(function c(s){var i,o;return v.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=n.getState(),c.next=3,r(s);case 3:if(s.type&&!e.excludeActionTypes.includes(s.type)){c.next=5;break}return c.abrupt("return");case 5:o=n.getState(),e.trackFields.some(function(e){return t(i,e)!==t(o,e)})&&a(o);case 8:case"end":return c.stop()}},c)}));return function(e){return c.apply(this,arguments)}}()}}}},{key:"deriveInitialState",value:function(e){var t=localStorage.getItem(this.key),a=this.unpack(t),n=e.settings,r=Object(L.a)(e,["settings"]),c=n.pss;return Object(K.a)({app:Object(K.a)({},a,{raw:t}),settings:Object(K.a)({},n,{isPssLocked:!!c,pss:c||a.pss||I.pss,bzz:a.bzz||I.bzz,revealAddress:void 0===a.revealAddress?I.revealAddress:a.revealAddress,size:(t||"").length})},r)}},{key:"unpack",value:function(e){var t=oe.a.decompress(e);return t?se.a.unpack(t):{}}}]),e}(),ue=a(90),pe=a(152),de=a(18),me=a(16),be=a(17),fe=a(28),he=a(337),ve=a(54),ge=a(332),ye=a(335),Ee=a(295),Oe=a(296),je=function(e){function t(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this))).url=e,a.reconnectInterval=n,a.resultSelector=r,a.serializer=c,a.defaultResultSelector=function(e){return JSON.parse(e.data)},a.defaultSerializer=function(e){return JSON.stringify(e)},a.connectionStatus=new fe.a(function(e){a.connectionObserver=e}).pipe(Object(ye.a)()).pipe(Object(Ee.a)()),r||(a.resultSelector=a.defaultResultSelector),a.serializer||(a.serializer=a.defaultSerializer),a.wsSubjectConfig={url:e,closeObserver:{next:function(e){a.socket=null,a.connectionObserver.next(!1)}},openObserver:{next:function(e){a.connectionObserver.next(!0)}}},a.connect(),a.connectionStatus.subscribe(function(e){a.reconnectionObservable||"boolean"!=typeof e||e||a.reconnect()}),a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"connect",value:function(){var e=this;this.socket=new ge.a(this.wsSubjectConfig),this.socket.subscribe(function(t){e.next(t)},function(t){e.socket||e.reconnect()})}},{key:"reconnect",value:function(){var e=this;this.reconnectionObservable=Object(he.a)(this.reconnectInterval).pipe(Object(Oe.a)(function(){return!e.socket})),this.reconnectionObservable.subscribe(function(){e.connect()},null,function(){e.reconnectionObservable=null,e.socket||(e.complete(),e.connectionObserver.complete())})}},{key:"send",value:function(e){this.socket.next(this.serializer(e))}}]),t}(ve.b),ke=function e(t){Object(ne.a)(this,e);var a=t.bzz,n=t.ws;this.subject=new je(n),this.client=new ue.SwarmClient({bzz:a,rpc:new pe.a(this.subject.socket)});var r=this;this.subject.connectionStatus.subscribe(function(e){e&&(r.client=new ue.SwarmClient({bzz:a,rpc:new pe.a(r.subject.socket)}))})},xe=Object(b.a)();var we=a(37),Ce=a(112),Te=a(331),Ne=a(47),Se=a.n(Ne),Ae=a(338),ze=a(308),_e=a(309),Pe=a(66),Ke=a(153),Re=a(35),Be=a(297),Ie=a(301),We=a(184),De=a(302),qe=a(304),Le=a(303),Me=a(305),Ue=a(4),Fe=a(170),He=a.n(Fe);var Ve=Object(Ue.a)({icon:{overflow:"hidden",borderRadius:"50%"}})(function(e){var t=e.classes,a=e.publicKey,n=e.size,c=e.style;return r.a.createElement("div",{className:t.icon,style:Object(K.a)({width:n,height:n},c)},r.a.createElement(He.a,{seed:a,size:8,scale:Math.ceil(n/8)}))}),Ge=function(e){function t(){var e,a;Object(ne.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(de.a)(this,(e=Object(me.a)(t)).call.apply(e,[this].concat(r)))).state={anchorEl:null},a.handleMenu=function(e){a.setState({anchorEl:e.currentTarget})},a.handleClose=function(){a.setState({anchorEl:null})},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.dispatch,n=e.account,c=e.errors,s=this.state.anchorEl,i=Boolean(s);if(c.length)return r.a.createElement(we.a,{to:"/settings"});var o=n.publicKey,l=n.username;return o?r.a.createElement(r.a.Fragment,null,r.a.createElement(Be.a,{"aria-owns":i?"menu-account":void 0,"aria-haspopup":"true",onClick:this.handleMenu,color:"inherit"},r.a.createElement(Ve,{publicKey:o,size:32})),r.a.createElement(We.a,{id:"menu-account",anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:i,onClose:this.handleClose},r.a.createElement(Ie.a,{className:t.menu,onClick:function(){a(Object(Re.d)("/profile"))}},r.a.createElement(De.a,null,r.a.createElement(Le.a,null)),r.a.createElement(qe.a,{primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},l||o)})),r.a.createElement(Ie.a,{onClick:function(){a(Object(Re.d)("/settings"))}},r.a.createElement(De.a,null,r.a.createElement(Me.a,null)),r.a.createElement(qe.a,{primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},"Settings")})))):null}}]),t}(n.Component),Je=Object(d.d)(Object(u.c)(function(e){var t=e||{account:{publicKey:"",username:""},errors:[]};return{account:t.account,errors:t.errors}}),Se()(function(e){return{menu:{maxWidth:300}}}))(Ge),Qe=a(306),Xe=a(307),Ze="/messenger/control";var $e=Object(d.d)(Object(u.c)(function(e){return{router:(e||{router:{location:{}}}).router}}))(function(e){var t=e.router,a=e.dispatch,n=t.location;return r.a.createElement(r.a.Fragment,null,n.pathname===Ze?r.a.createElement(Be.a,{edge:"start",color:"inherit","aria-label":"Close",onClick:function(){a(Re.e.goBack())}},r.a.createElement(Qe.a,null)):r.a.createElement(Be.a,{edge:"start",color:"inherit","aria-label":"Control panel",onClick:function(){a(Object(Re.d)(Ze))}},r.a.createElement(Xe.a,null)))}),Ye=a(174),et=a.n(Ye);var tt=Object(d.d)(Object(u.c)(),Se()(function(e){return{grow:{flexGrow:1},title:{color:"inherit",lineHeight:"2.4rem"},logo:{width:36,marginRight:e.spacing(2),display:"block",float:"left"}}}))(function(e){var t=e.classes,a=e.dispatch,n=e.isNarrow;return r.a.createElement(ze.a,{color:"default"},r.a.createElement(_e.a,null,n&&r.a.createElement($e,null),r.a.createElement(Pe.a,{variant:"h5",color:"inherit",noWrap:!0,className:t.grow},r.a.createElement(Ke.a,{className:t.title,style:{textDecoration:"none"},onClick:function(){a(Object(Re.d)("/"))}},r.a.createElement("img",{src:et.a,alt:"Nebula",className:t.logo}),r.a.createElement(Pe.a,{variant:"h5",color:"inherit",noWrap:!0},"Nebula"))),r.a.createElement(Je,null)))}),at=a(310),nt=a(175),rt=a.n(nt),ct=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.errors;return r.a.createElement("div",{className:a.fixed},n.map(function(t,n){return r.a.createElement(at.a,{key:n,className:a.error,message:t,action:[r.a.createElement(Be.a,{key:"close","aria-label":"Close",color:"inherit",onClick:function(){return e.dismiss(t)}},r.a.createElement(rt.a,{className:a.icon}))]})}))}},{key:"dismiss",value:function(e){this.props.dispatch(function(e){return function(){var t=Object(g.a)(v.a.mark(function t(a){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:k,error:e});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}(e))}}]),t}(n.Component),st=Object(d.d)(Object(u.c)(function(e){return{errors:(e||[]).errors}}),Object(Ue.a)(function(e){return{fixed:{position:"fixed",top:0,left:"50%",right:"auto",zIndex:1400,transform:"translateX(-50%)"},error:{backgroundColor:e.palette.error.dark}}}))(ct),it=a(176),ot=a.n(it),lt=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).state={isOpen:!1},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"componentWillUpdate",value:function(e){var t=this;this.props.isConnected||!e.isConnected||this.state.isOpen||(this.setState({isOpen:!0}),setTimeout(function(){t.setState({isOpen:!1})},3e3))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isStarted,n=e.isConnected,c=e.children,s=e.location.pathname;return a&&!n&&"/settings"!==s?r.a.createElement(we.a,{to:"/settings"}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:t.fixed},this.state.isOpen&&r.a.createElement(at.a,{className:t.success,message:"Connected"}),!n&&r.a.createElement(at.a,{className:t.error,message:"No connection"})),c)}}]),t}(n.Component),ut=Object(d.d)(Object(u.c)(function(e){return(e||{app:{isConnected:!1,isStarted:!1}}).app}),Object(Ue.a)(function(e){return{fixed:{position:"fixed",top:6,left:"50%",right:"auto",zIndex:1400,transform:"translateX(-50%)"},success:{backgroundColor:ot.a[600]},error:{backgroundColor:e.palette.error.dark}}}))(Object(we.f)(lt));var pt=Se()(function(e){return{layout:{height:"100%",paddingTop:64}}})(function(e){var t=e.classes,a=e.children,n=e.isNarrow;return r.a.createElement(ut,null,r.a.createElement(Ae.a,null),r.a.createElement(tt,{isNarrow:n}),r.a.createElement("main",{className:t.layout},a),r.a.createElement(st,null))}),dt=a(311),mt=a(186),bt=a(333),ft=a(314),ht=a(315),vt=a(178),gt=a.n(vt),yt=a(177),Et=a.n(yt),Ot=a(151),jt=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).reset=function(){a.props.dispatch(function(){var e=Object(g.a)(v.a.mark(function e(t){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:W,settings:{pss:I.pss,bzz:I.bzz,revealAddress:I.revealAddress}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},a.save=function(){var e=Object.assign({},a.props.settings,a.state),t=e.pss,n=e.bzz,r=e.revealAddress;a.props.dispatch(function(e){var t=e.pss,a=e.bzz,n=e.revealAddress;return function(){var e=Object(g.a)(v.a.mark(function e(r){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r({type:W,settings:{pss:t,bzz:a,revealAddress:n}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}({pss:t,bzz:n,revealAddress:r}))},a.state={},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.settings,c=t.app;return n.pss?r.a.createElement(dt.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(dt.a,{item:!0,md:6,sm:8,xs:11},!c.isConnected&&r.a.createElement(at.a,{className:a.info,message:r.a.createElement("div",null,"There is no connection. Make sure you did everything right in order to ",r.a.createElement("a",{href:"https://github.com/okamilab/nebula#running-nebula",target:"_block"},"run nebula"))}),r.a.createElement(Pe.a,{variant:"h5",color:"inherit",noWrap:!0,className:a.sectionTitle},"Settings"),r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"General"),r.a.createElement(mt.a,{square:!0,className:a.section},r.a.createElement(dt.a,{container:!0,spacing:0},r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"PSS endpoint (WebSocket)")),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(bt.a,{id:"pss",onChange:function(t){return e.setState({pss:t.target.value})},defaultValue:n.pss,disabled:n.isPssLocked})),r.a.createElement(dt.a,{item:!0,xs:12},r.a.createElement(Pe.a,{variant:"caption"},"After updating the field you need to restart the app (refresh page)")),r.a.createElement(dt.a,{item:!0,xs:12,className:a.divider},r.a.createElement(ft.a,null)),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"BZZ endpoint")),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(bt.a,{id:"bzz",onChange:function(t){return e.setState({bzz:t.target.value})},defaultValue:n.bzz})),r.a.createElement(dt.a,{item:!0,xs:12},r.a.createElement(Pe.a,{variant:"caption"},"After updating the field you need to restart the app (refresh page)")),r.a.createElement(dt.a,{item:!0,xs:12,className:a.divider},r.a.createElement(ft.a,null)),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Local storage")),r.a.createElement(dt.a,{item:!0,xs:6},Et()(n.size)))),r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"Security"),r.a.createElement(mt.a,{square:!0,className:a.section},r.a.createElement(dt.a,{container:!0,spacing:0},r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Reveal address partially")),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(bt.a,{id:"revealAddress",select:!0,onChange:function(t){return e.setState({revealAddress:+t.target.value})},value:void 0===this.state.revealAddress?n.revealAddress:this.state.revealAddress},r.a.createElement(Ie.a,{value:0},"Broadcast"),r.a.createElement(Ie.a,{value:4},"4"),r.a.createElement(Ie.a,{value:8},"8"),r.a.createElement(Ie.a,{value:16},"16"),r.a.createElement(Ie.a,{value:32},"Full"))))),r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0,className:a.sectionTitle},"About"),r.a.createElement(mt.a,{square:!0,className:a.section},r.a.createElement(dt.a,{container:!0,spacing:0},r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(Pe.a,{variant:"subtitle1",color:"inherit",noWrap:!0},"Version")),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement("a",{href:"https://github.com/okamilab/nebula/releases/tag/v".concat(Ot.version),target:"_block"},Ot.version)))),r.a.createElement("div",{className:a.actionBar},r.a.createElement(ht.a,{variant:"contained",onClick:this.reset,className:a.button},"Reset"),r.a.createElement(ht.a,{variant:"contained",color:"primary",onClick:this.save,className:a.button},"Save")))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),kt=Object(d.d)(Object(u.c)(function(e){var t=e||{settings:{pss:I.pss,bzz:I.bzz,isPssLocked:!1,revealAddress:I.revealAddress,size:0},app:{isConnected:!1}};return{settings:t.settings,app:t.app}}),Object(Ue.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,padding:e.spacing(2)},divider:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},actionBar:{paddingTop:e.spacing(2)},button:{marginRight:e.spacing(2)},info:{backgroundColor:gt.a[300],color:"#000",maxWidth:"100%"}}}))(jt),xt=a(33),wt=a(179),Ct=a(313),Tt=a(312),Nt=a(340),St=a(316),At=a(339),zt=a(317),_t=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).state={tooltipOpen:!1,copied:!1},a.toggle=a.toggle.bind(Object(xt.a)(Object(xt.a)(a))),a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"toggle",value:function(){this.setState({tooltipOpen:!this.state.tooltipOpen,copied:this.state.tooltipOpen})}},{key:"render",value:function(){var e=this,t=this.props,a=t.name,n=t.value,c=t.label,s=t.classes;if(!n||!n.length)return null;var i=n.length>22?"".concat(n.substr(0,16),"...").concat(n.substr(n.length-4)):n;return r.a.createElement(Ct.a,{margin:"normal"},r.a.createElement(Nt.a,{htmlFor:"".concat(a,"_key")},c),r.a.createElement(Tt.a,{id:"".concat(a,"_key"),type:"text",value:i,disabled:!0,className:s.input,endAdornment:r.a.createElement(St.a,{position:"end"},r.a.createElement(wt.CopyToClipboard,{id:"".concat(a,"_key"),text:n,onCopy:function(){return e.setState({copied:!0})}},r.a.createElement(At.a,{title:this.state.copied?"Copied":"Copy to clipboard",placement:"right",onClose:function(){setTimeout(function(){return e.setState({copied:!1})},200)}},r.a.createElement(Be.a,null,r.a.createElement(zt.a,{fontSize:"small"})))))}))}}]),t}(n.Component),Pt=Object(Ue.a)({input:{"&:before":{borderBottomStyle:"none!important"}}})(_t),Kt=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).save=Object(g.a)(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.assign({},a.props,a.state),n=t.username,e.next=3,a.props.dispatch(N(n));case 3:case"end":return e.stop()}},e)})),a.state={},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.account,n=t.classes;if(!a)return r.a.createElement("div",null,"Loading");var c=a.username,s=a.publicKey,i=a.overlayAddress;return s?r.a.createElement(dt.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(dt.a,{item:!0,md:6,sm:8,xs:11},r.a.createElement(Pe.a,{variant:"h5",color:"inherit",noWrap:!0,className:n.sectionTitle},"Profile"),r.a.createElement(mt.a,{square:!0,className:n.section},r.a.createElement(dt.a,{container:!0,spacing:0},r.a.createElement(dt.a,{item:!0,xs:3},s?r.a.createElement(Ve,{publicKey:s,size:78}):null),r.a.createElement(dt.a,{item:!0,xs:6},r.a.createElement(bt.a,{id:"username",label:"User name",onChange:function(t){return e.setState({username:t.target.value})},defaultValue:c})),r.a.createElement(dt.a,{item:!0,xs:3},r.a.createElement(ht.a,{variant:"contained",color:"primary",onClick:this.save,className:n.button,disabled:!this.state.username},"Save")),r.a.createElement(dt.a,{item:!0,xs:3}),r.a.createElement(dt.a,{item:!0,xs:9},r.a.createElement(Pt,{name:"publicKey",value:s,label:"Public key"})),r.a.createElement(dt.a,{item:!0,xs:3}),r.a.createElement(dt.a,{item:!0,xs:9},r.a.createElement(Pt,{name:"overlayAddress",value:i,label:"Address"})))))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),Rt=Object(d.d)(Object(u.c)(function(e){return{account:(e||{account:{publicKey:"",username:""}}).account}}),Object(Ue.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,marginTop:e.spacing(2),padding:e.spacing(2)},button:{marginTop:e.spacing(2)}}}))(Kt),Bt=a(324),It=a(326),Wt=a(327),Dt=a(329),qt=a(300),Lt=a(267),Mt=a(325),Ut=a(328),Ft=a(318),Ht=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this.props,t=e.list,a=e.title,n=e.renderItem;if(!t||!t.length)return null;var c=t.map(n);return r.a.createElement(qt.a,{subheader:r.a.createElement(Ft.a,null,a)},c)}}]),t}(n.Component);Ht.defaultProps={renderItem:function(e,t){return r.a.createElement(Lt.a,{key:t,button:!0},r.a.createElement(qe.a,{disableTypography:!0,primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},e.key)}))}};var Vt=Se()(function(e){return{}})(Ht),Gt=a(336),Jt=a(322),Qt=a(320),Xt=a(321),Zt=a(319),$t=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).accept=function(){var e=a.props,t=e.publicKey,n=e.address;(0,e.dispatch)(Object(E.h)(t,n)),a.toggle()},a.decline=function(){var e=a.props,t=e.publicKey,n=e.address;(0,e.dispatch)(Object(E.i)(t,n)),a.toggle()},a.state={modal:!1},a.toggle=a.toggle.bind(Object(xt.a)(Object(xt.a)(a))),a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"toggle",value:function(){this.setState({modal:!this.state.modal})}},{key:"render",value:function(){var e=this.props.publicKey;return r.a.createElement(Lt.a,{button:!0,onClick:this.toggle},r.a.createElement(qe.a,{disableTypography:!0,primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},e)}),r.a.createElement(Gt.a,{open:this.state.modal,onClose:this.toggle,"aria-labelledby":"form-dialog-title"},r.a.createElement(Zt.a,{id:"form-dialog-title"},"Received contact"),r.a.createElement(Qt.a,null,r.a.createElement(Xt.a,null,r.a.createElement(Pe.a,{noWrap:!0},"Do you want to accept request from ",e,"?"))),r.a.createElement(Jt.a,null,r.a.createElement(ht.a,{onClick:this.decline,color:"default"},"Decline"),r.a.createElement(ht.a,{onClick:this.accept,variant:"contained",color:"primary"},"Accept"))))}}]),t}(n.Component),Yt=Object(d.d)(Object(u.c)())($t),ea=a(68),ta=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this.props,t=e.contacts,a=e.dispatch,n=Object(ea.b)(Object.values(t),"type");return r.a.createElement(r.a.Fragment,null,r.a.createElement(Vt,{list:n.sent_request,title:"Sent"}),r.a.createElement(Vt,{list:n.received_request,title:"Received",renderItem:function(e,t){return r.a.createElement(Yt,{key:t,publicKey:e.key,address:e.address})}}),r.a.createElement(Vt,{list:n.added,title:"Contacts",renderItem:function(e,t){return r.a.createElement(Lt.a,{key:t,button:!0,onClick:function(){a(Object(Re.d)("/messenger/contact/".concat(G()(e.key))))}},r.a.createElement(De.a,null,r.a.createElement(Ve,{publicKey:e.key,size:32})),r.a.createElement(qe.a,{disableTypography:!0,primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},e.username||e.key)}))}}))}}]),t}(n.Component),aa=Object(d.d)(Object(u.c)(function(e){return{contacts:(e||{}).contacts}}),Object(Ue.a)(function(e){return{}}))(ta),na=a(323),ra=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).invite=Object(g.a)(v.a.mark(function e(){var t,n,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.state,n=t.publicKey,r=t.address,a.setState({error:null}),e.next=5,a.props.dispatch(Object(E.j)(n,r));case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),a.setState({error:e.t0.message}),e.abrupt("return");case 11:a.toggle();case 12:case"end":return e.stop()}},e,null,[[0,7]])})),a.state={modal:!1,publicKey:"",address:"",error:""},a.toggle=a.toggle.bind(Object(xt.a)(Object(xt.a)(a))),a.onKeyPress=a.onKeyPress.bind(Object(xt.a)(Object(xt.a)(a))),a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"toggle",value:function(e){e&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),this.setState({error:null,modal:!this.state.modal})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.state.publicKey&&this.invite()}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state.error;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Be.a,{color:"inherit",onClick:this.toggle},r.a.createElement(na.a,null)),r.a.createElement(Gt.a,{open:this.state.modal,onClose:this.toggle,"aria-labelledby":"form-dialog-title"},r.a.createElement(Zt.a,{id:"form-dialog-title"},"Invite contact"),r.a.createElement(Qt.a,null,r.a.createElement(Xt.a,null,a?r.a.createElement(at.a,{message:a.message||a,className:t.error}):null),r.a.createElement(bt.a,{autoFocus:!0,margin:"dense",id:"contactAddress",label:"Contact public key *",type:"text",fullWidth:!0,onChange:function(t){return e.setState({publicKey:t.target.value})},onKeyPress:this.onKeyPress}),r.a.createElement(bt.a,{margin:"dense",id:"contactPublicKey",label:"Contact address",type:"text",fullWidth:!0,onChange:function(t){return e.setState({address:t.target.value})},onKeyPress:this.onKeyPress})),r.a.createElement(Jt.a,null,r.a.createElement(ht.a,{onClick:this.toggle,color:"default"},"Cancel"),r.a.createElement(ht.a,{onClick:this.invite,disabled:!this.state.publicKey,variant:"contained",color:"primary"},"Send request"))))}}]),t}(n.Component),ca=Object(d.d)(Object(u.c)(),Object(Ue.a)(function(e){return{error:{backgroundColor:e.palette.error.dark}}}))(ra),sa=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this.props,t=e.chats,a=e.dispatch;return r.a.createElement(qt.a,{component:"div",disablePadding:!0},Object.values(t).map(function(e,t){return r.a.createElement(Lt.a,{key:t,button:!0,onClick:function(){a(Object(Re.d)("/messenger/chat/".concat(G()(e.key))))}},r.a.createElement(De.a,null,r.a.createElement(Ve,{publicKey:e.key,size:32})),r.a.createElement(qe.a,{disableTypography:!0,primary:r.a.createElement(Pe.a,{color:"inherit",noWrap:!0},e.key)}))}))}}]),t}(n.Component),ia=Object(d.d)(Object(u.c)(function(e){return{chats:(e||[]).chats}}),Se()(function(e){return{}}))(sa),oa=function(e){function t(){var e,a;Object(ne.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(de.a)(this,(e=Object(me.a)(t)).call.apply(e,[this].concat(r)))).state={isContactsOpen:!0,isChatsOpen:!0},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(qt.a,{component:"nav"},r.a.createElement(Lt.a,{button:!0,onClick:function(){e.setState({isContactsOpen:!e.state.isContactsOpen})}},r.a.createElement(De.a,null,r.a.createElement(Bt.a,null)),r.a.createElement(qe.a,{primary:"Contacts"}),r.a.createElement(Mt.a,{style:{paddingRight:20}},r.a.createElement(ca,null)),r.a.createElement("span",null,this.state.isContactsOpen?r.a.createElement(It.a,null):r.a.createElement(Wt.a,null))),r.a.createElement(Ut.a,{in:this.state.isContactsOpen,unmountOnExit:!0},r.a.createElement(aa,null)),r.a.createElement(Lt.a,{button:!0,onClick:function(){e.setState({isChatsOpen:!e.state.isChatsOpen})}},r.a.createElement(De.a,null,r.a.createElement(Dt.a,null)),r.a.createElement(qe.a,{primary:"Chats"}),this.state.isChatsOpen?r.a.createElement(It.a,null):r.a.createElement(Wt.a,null)),r.a.createElement(Ut.a,{in:this.state.isChatsOpen,unmountOnExit:!0},r.a.createElement(ia,null)))}}]),t}(n.Component);var la=Object(Ue.a)({root:{flexGrow:1,maxWidth:500,height:"100%"}})(function(e){var t=e.classes;return r.a.createElement(mt.a,{square:!0,className:t.root},r.a.createElement(oa,null))});var ua=Se()({container:{width:"100%",height:"100%",margin:0,padding:0},cell:{margin:0,padding:0,height:"100%"}})(function(e){var t=e.classes,a=e.children,n=e.isNarrow;return r.a.createElement(dt.a,{container:!0,spacing:0,className:t.container},!n&&r.a.createElement(dt.a,{item:!0,xs:3,className:t.cell},r.a.createElement(la,null)),r.a.createElement(dt.a,{item:!0,xs:n?12:9,className:t.cell},a))}),pa=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isNarrow,n=e.contact,c=e.dispatch;if(!n)return r.a.createElement("div",null,"Contact not found");var s=n.username,i=n.key,o=n.address;return i?r.a.createElement(ua,{isNarrow:a},r.a.createElement(dt.a,{container:!0,spacing:0,justify:"center",style:{paddingTop:10}},r.a.createElement(dt.a,{item:!0,md:6,sm:8,xs:11},r.a.createElement(Pe.a,{variant:"h5",color:"inherit",noWrap:!0,className:t.sectionTitle},"Contact"),r.a.createElement(mt.a,{square:!0,className:t.section},r.a.createElement(dt.a,{container:!0,spacing:0},r.a.createElement(dt.a,{item:!0,xs:3},i?r.a.createElement(Ve,{publicKey:i,size:78}):null),r.a.createElement(dt.a,{item:!0,xs:9},r.a.createElement(bt.a,{id:"username",label:"User name",disabled:!0,defaultValue:s})),r.a.createElement(dt.a,{item:!0,xs:3}),r.a.createElement(dt.a,{item:!0,xs:9},r.a.createElement(Pt,{name:"publicKey",value:i,label:"Public key"})),r.a.createElement(dt.a,{item:!0,xs:3}),r.a.createElement(dt.a,{item:!0,xs:9},r.a.createElement(Pt,{name:"address",value:o,label:"Address"})))),r.a.createElement("div",{className:t.actionBar},r.a.createElement(ht.a,{variant:"contained",color:"primary",className:t.button,onClick:function(){c(Object(Re.d)("/messenger/chat/".concat(G()(i))))}},"Chat"))))):r.a.createElement("div",null,"No data")}}]),t}(n.Component),da=Object(d.d)(Object(u.c)(function(e,t){return{contact:(e||{}).contacts[t.match.params.key]}}),Object(Ue.a)(function(e){return{sectionTitle:{marginTop:e.spacing(2)},section:{borderRadius:5,marginTop:e.spacing(2),padding:e.spacing(2)},actionBar:{paddingTop:e.spacing(2)},button:{marginRight:e.spacing(2)}}}))(pa),ma=a(121),ba=a(268),fa=a(330),ha=Object(Ue.a)(function(e){return{divider:{textAlign:"center",borderBottom:"1px solid #ddd",lineHeight:"0.3em",margin:"10px 0 20px"},title:{background:e.palette.background.default,padding:"0 6px",color:"#bbb",fontSize:"12px"}}})(function(e){var t=e.classes,a=e.date;return r.a.createElement("div",{className:t.divider},r.a.createElement("span",{className:t.title},a.toLocaleDateString()))}),va=function(e){function t(){var e,a;Object(ne.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(de.a)(this,(e=Object(me.a)(t)).call.apply(e,[this].concat(r)))).download=function(e){e&&a.props.dispatch(Object(O.g)(e))},a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"renderMessageContent",value:function(){var e=this,t=this.props,a=t.classes,n=t.message,c=t.isOwn,s=n.text;switch(s.startsWith("bzz:/")){case!0:return r.a.createElement("div",{className:a.file},r.a.createElement("div",{className:a.fileName},"File: ",s.substr(5,15),"..."),r.a.createElement("hr",{className:a.divider}),r.a.createElement("div",{className:a.actionBar},r.a.createElement(ht.a,{onClick:function(){return e.download(s.substr(5))}},"Download")));default:return r.a.createElement("div",{className:"".concat(a.body," ").concat(c?a.ownedBody:null)},n.text)}}},{key:"renderMessage",value:function(){var e,t=this.props,a=t.classes,c=t.message,s=t.sender,i=t.isOwn,o=t.showHeader,l=new Date(c.timestamp);switch(i){case!0:return o&&(e=r.a.createElement("div",{className:a.header},l.toLocaleTimeString())),r.a.createElement(n.Fragment,null,e,this.renderMessageContent());default:var u=r.a.createElement("div",{style:{width:32}}),p=s.key,d=s.username;return o&&(u=r.a.createElement("div",null,r.a.createElement(Ve,{publicKey:p,size:32})),e=r.a.createElement("div",{className:a.header},d||"".concat(p.substr(0,8),"..."),", ",l.toLocaleTimeString())),r.a.createElement("div",{className:a.layout},u,r.a.createElement("div",{className:a.content},e,this.renderMessageContent()))}}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.isOwn;return r.a.createElement("div",{className:"".concat(t.block," ").concat(a?t.owned:null)},this.renderMessage())}}]),t}(n.Component),ga=Object(d.d)(Object(u.c)(),Object(Ue.a)(function(e){return{file:{backgroundColor:"#f1f1f4",display:"inline-block",padding:10,borderRadius:6},fileName:{paddingTop:e.spacing(1)},divider:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},actionBar:{textAlign:"center",paddingBottom:e.spacing(1)},block:{textAlign:"left",paddingTop:2},owned:{textAlign:"right",paddingRight:10},layout:{display:"flex"},content:{paddingLeft:e.spacing(1)},header:{fontSize:12,color:"#bbb"},body:{backgroundColor:"#f2f6f9",display:"inline-block",padding:"2px 10px",marginRight:10,borderRadius:6,textAlign:"left"},ownedBody:{backgroundColor:"#dbf4fd",marginRight:0,marginLeft:40}}}))(va),ya=function(e){function t(e){var a;return Object(ne.a)(this,t),(a=Object(de.a)(this,Object(me.a)(t).call(this,e))).send=function(){var e=a.props.id;a.props.dispatch(Object(O.j)(e,a.state.msg)),a.setState({msg:""})},a.upload=function(e){if(e.target.files.length){var t=a.props.id;a.props.dispatch(Object(O.i)(t,e.target.files[0]))}},a.state={msg:""},a.onChange=a.onChange.bind(Object(xt.a)(Object(xt.a)(a))),a.onKeyPress=a.onKeyPress.bind(Object(xt.a)(Object(xt.a)(a))),a}return Object(be.a)(t,e),Object(re.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){ma.scroller.scrollTo("bottom",{duration:400,delay:0,smooth:"easeInOutQuart",containerId:"scroll-container"})}},{key:"onChange",value:function(e){this.setState({msg:e.target.value})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.state.msg&&this.send()}},{key:"isSameDay",value:function(e,t){return e.getDay()===t.getDay()}},{key:"showMsgHeader",value:function(e,t,a){return 0===e||t.sender!==a.sender}},{key:"getParticipants",value:function(){var e=this.props,t=e.chat,a=e.account,n=e.contacts,r=a.publicKey,c=Object(H.a)({},G()(r),{key:r});return Object.keys(t.participants).forEach(function(e){n[e]&&(c[e]=n[e])}),c}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,c=t.isNarrow,s=t.chat,i=t.account;if(!s)return r.a.createElement("div",null,"Chat not found");var o=this.getParticipants(),l=Object.values(s.messages).sort(function(e,t){return e.timestamp-t.timestamp}),u=i.publicKey;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ua,{isNarrow:c},r.a.createElement(ma.Element,{id:"scroll-container",className:a.scrollContainer},r.a.createElement(dt.a,{container:!0,spacing:0,justify:"center"},r.a.createElement(dt.a,{item:!0,xs:10,lg:10,xl:8,className:a.list},l.map(function(t,a){var c=o[t.sender],s=new Date(t.timestamp),i=0===a||!e.isSameDay(s,new Date(l[a-1].timestamp));return r.a.createElement(n.Fragment,{key:a},i?r.a.createElement(ha,{date:s}):null,r.a.createElement("div",null,r.a.createElement(ga,{message:t,sender:c,isOwn:c.key===u,showHeader:e.showMsgHeader(a,t,a>0?l[a-1]:null)||i})))}),r.a.createElement(ma.Element,{name:"bottom"}))))),r.a.createElement("div",{className:a.fixed},r.a.createElement(dt.a,{container:!0,spacing:0},!c&&r.a.createElement(dt.a,{item:!0,sm:3}),r.a.createElement(dt.a,{item:!0,xs:c?12:9},r.a.createElement(dt.a,{container:!0,spacing:0,justify:"center"},r.a.createElement(dt.a,{item:!0,xs:10,lg:10,xl:8},r.a.createElement(mt.a,{className:a.root,elevation:1},r.a.createElement(ba.a,{className:a.input,placeholder:"Type a message here",value:this.state.msg,onChange:this.onChange,onKeyPress:this.onKeyPress,autoFocus:!0}),r.a.createElement(Be.a,{className:a.iconButton,onClick:this.send,disabled:!this.state.msg},r.a.createElement(fa.a,null)))))))))}}]),t}(n.Component),Ea=Object(d.d)(Object(u.c)(function(e,t){var a=e||{chats:[],account:{},contacts:{}},n=a.chats,r=a.account,c=a.contacts,s=t.match.params.key;return{id:s,chat:n[s],account:r,contacts:c}}),Object(Ue.a)(function(e){return{scrollContainer:{height:"100%",overflow:"scroll"},list:{paddingBottom:80},root:{marginTop:e.spacing(4),marginBottom:e.spacing(4),marginRight:e.spacing(2),padding:"2px 4px",display:"flex"},input:{marginLeft:8,flex:1},file:{width:.1,height:.1,opacity:0,overflow:"hidden",position:"absolute",zIndex:"-1",cursor:"pointer"},fileLabel:{margin:0},iconButton:{padding:10},divider:{width:1,height:28,marginTop:8,marginBottom:8,marginLeft:4,marginRight:4},fixed:{position:"fixed",left:0,right:0,bottom:0}}}))(ya),Oa=function(e){function t(){return Object(ne.a)(this,t),Object(de.a)(this,Object(me.a)(t).apply(this,arguments))}return Object(be.a)(t,e),Object(re.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)(function(){var e=Object(g.a)(v.a.mark(function e(t,a,n){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:S}),n().connection.subscribe(function(e){e?(t({type:A}),t(function(){var e=Object(g.a)(v.a.mark(function e(t,a,n){var r,c,s,i,o,l,u,p,d;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:w}),e.prev=1,r=n(),c=r.client,e.next=5,Promise.all([c.pss.getPublicKey(),c.pss.baseAddr()]);case 5:s=e.sent,i=Object(y.a)(s,2),o=i[0],l=i[1],u=a(),p=u.app,d=p[o]||{},t((m={publicKey:o,overlayAddress:l,username:d.username},{type:C,account:m})),t(Object(E.k)(o)),t(Object(O.h)(o)),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t(x(e.t0.message));case 19:case"end":return e.stop()}var m},e,null,[[1,16]])}));return function(t,a,n){return e.apply(this,arguments)}}())):t({type:z})},function(e){t(x(e.message))});case 3:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}())}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.children)}}]),t}(r.a.Component),ja=Object(u.c)()(Oa);a(263);var ka=Object(d.d)(Object(u.c)(function(e){return{settings:(e||{settings:{mode:"full",home:"/"}}).settings}}))(function(e){var t=e.settings,a=Object(Ce.a)(),n=!Object(Te.a)(a.breakpoints.up("md"))||"narrow"===t.mode;return r.a.createElement(ja,null,r.a.createElement(l.a,{titleTemplate:"Nebula - %s"}),r.a.createElement(pt,{isNarrow:n},r.a.createElement(we.d,null,r.a.createElement(we.b,{exact:!0,path:"/settings",component:kt}),r.a.createElement(we.b,{exact:!0,path:"/profile",component:Rt}),r.a.createElement(we.b,{exact:!0,path:"/",render:function(e){return r.a.createElement(ua,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(we.b,{exact:!0,path:"/messenger/contact/:key",render:function(e){return r.a.createElement(da,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(we.b,{exact:!0,path:"/messenger/chat/:key",render:function(e){return r.a.createElement(Ea,Object.assign({},e,{isNarrow:n}))}}),r.a.createElement(we.b,{exact:!0,path:"/messenger/control",render:function(e){return r.a.createElement(oa,Object.assign({},e,{isNarrow:n}))}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var xa=a(181),wa=new URLSearchParams(window.location.search),Ca=function(e){var t=d.d,a=new le("nebula"),n={bzz:(e=a.deriveInitialState(e)).settings.bzz,ws:e.settings.pss},r=new ke(n),c=[Object(f.a)(xe),a.middleware(),m.a.withExtraArgument(function(){return{client:r.client,connection:r.subject.connectionStatus}})],s=[d.a.apply(void 0,c)];return Object(d.e)(ae(xe),e,t.apply(void 0,s))}({settings:{mode:"true"===(wa.get("narrow")||"").toLowerCase()?"narrow":"full",home:wa.get("home")||"/",pss:wa.get("pss")||null}});s.a.render(r.a.createElement(i.AppContainer,null,r.a.createElement(o.HelmetProvider,null,r.a.createElement(u.a,{store:Ca},r.a.createElement(p.a,{history:xe},r.a.createElement(ka,null))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}),Object(xa.run)(Ca)},32:function(e,t,a){"use strict";var n=a(82),r=a(5),c=a.n(r),s=a(25),i=a(31),o=a(13),l=a(90),u=a(185),p=a(266),d=a(24),m=a.n(d),b=/^0x[0-9a-f]{130}$/,f={isValidPubKey:function(e,t){if(e===t)throw new Error("Invalid contact key: this is your own key");if(!b.test(e))throw new Error('Invalid contact key: must be an hexadecimal string prefixed with "0x"');return!0}},h=a(36),v=a(68);a.d(t,"a",function(){return g}),a.d(t,"g",function(){return y}),a.d(t,"f",function(){return E}),a.d(t,"e",function(){return O}),a.d(t,"d",function(){return j}),a.d(t,"b",function(){return k}),a.d(t,"c",function(){return x}),a.d(t,"k",function(){return S}),a.d(t,"j",function(){return A}),a.d(t,"h",function(){return P}),a.d(t,"i",function(){return K});var g="CONTACTS_RESTORE",y="CONTACT_SUBSCRIBE",E="CONTACT_REQUEST",O="CONTACT_RECEIVE",j="CONTACT_MUTATE",k="CONTACT_ACCEPT",x="CONTACT_DECLINE";function w(e){return{key:e.key,data:e.msg.toObject()}}function C(e,t){return T.apply(this,arguments)}function T(){return(T=Object(o.a)(c.a.mark(function e(t,a){var n,r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pss.stringToTopic(a);case 2:return n=e.sent,e.next=5,t.pss.createTopicSubscription(n);case 5:return r=e.sent,e.abrupt("return",r.pipe(Object(u.a)(w),Object(p.a)(function(e){return"contact_request"===e.data.type&&null!=e.data.payload&&null!=e.data.payload.topic||"contact_response"===e.data.type}),Object(u.a)(function(e){return{key:e.key,type:e.data.type,payload:e.data.payload}})));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function N(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n){var r,o,l,u,p,d,b;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t(),o=r.contacts,l=m()(n.key),u=o[l],"contact_request"!==n.type||null!=u&&"received_request"!==u.type){a.next=8;break}p={key:n.key,type:"received_request",topic:n.payload.topic,username:n.payload.username,address:n.payload.overlay_address},e({type:O,contacts:Object(i.a)({},l,p)}),a.next=26;break;case 8:if("contact_request"!==n.type||null!=u&&"added"!==u.type){a.next=14;break}d=Object(s.a)({},u,{topic:n.payload.topic,username:n.payload.username,address:n.payload.overlay_address}),e({type:j,contacts:Object(i.a)({},l,d)}),e(P(n.key,n.payload.overlay_address)),a.next=26;break;case 14:if("contact_response"!==n.type||!n.payload.contact||null==u||"sent_declined"!==u.type&&"sent_request"!==u.type){a.next=20;break}b=Object(s.a)({},u,{type:"added",username:n.payload.username,address:n.payload.overlay_address}),e({type:j,contacts:Object(i.a)({},l,b)}),e(Object(h.f)(b)),a.next=26;break;case 20:if("contact_response"!==n.type||n.payload.contact||null==u||"sent_declined"!==u.type&&"sent_request"!==u.type){a.next=24;break}e({type:x,hash:l}),a.next=26;break;case 24:return console.error("unhandled event",n),a.abrupt("return");case 26:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function S(e){return function(){var t=Object(o.a)(c.a.mark(function t(a,n){var r,s,i,l;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n(),s=r.app,i=s[e]||{},l=i.contacts||{},a({type:g,contacts:l}),a(function(){var e=Object(o.a)(c.a.mark(function e(t,a,n){var r,s,i,o,l,u;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a(),s=r.account,i=n(),o=i.client,e.next=4,C(o,s.publicKey);case 4:l=e.sent,u=l.subscribe(N(t,a)),t({type:y,sub:u});case 7:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}());case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function A(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(r,s,o){var u,p,d,b,h,g,y,O,j,k,x,w,C,T;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(u=s(),p=u.account,d=u.contacts,b=u.settings,h=Object(l.hexValueType)(e),g=m()(h),f.isValidPubKey(h,p.publicKey),!(y=d[g])||"received_request"!==y.type){a.next=8;break}return r(P(h,t)),a.abrupt("return");case 8:if(!y||"sent_request"===y.type){a.next=10;break}throw new Error("The contact already present in your list of contacts");case 10:return O=o(),j=O.client,a.next=13,Promise.all([j.pss.stringToTopic(h),j.pss.stringToTopic(Math.random().toString(36).slice(2))]);case 13:return k=a.sent,x=Object(n.a)(k,2),w=x[0],C=x[1],a.next=19,j.pss.setPeerPublicKey(h,w,t||"0x");case 19:return T={type:"contact_request",payload:{username:p.username,message:null,topic:C,overlay_address:Object(v.a)(p.overlayAddress,b.revealAddress)},utc_timestamp:Date.now()},a.next=22,j.pss.sendAsym(h,w,T);case 22:r({type:E,contacts:Object(i.a)({},g,{key:h,topic:C,type:"sent_request"})});case 23:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function z(e,t,a,n,r){return _.apply(this,arguments)}function _(){return(_=Object(o.a)(c.a.mark(function e(t,a,n,r,i){var o,l,u,p,d,m;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pss.stringToTopic(n);case 2:if(o=e.sent,l={contact:i},!i){e.next=9;break}return u=a(),p=u.account,d=u.settings,l=Object(s.a)({},l,{username:p.username,overlay_address:Object(v.a)(p.overlayAddress,d.revealAddress)}),e.next=9,t.pss.setPeerPublicKey(n,o,r||"0x");case 9:return m={type:"contact_response",payload:l,utc_timestamp:Date.now()},e.next=12,t.pss.sendAsym(n,o,m);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n,r,o){var l,u,p,d,b,f;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return l=r(),u=l.contacts,p=o(),d=p.client,a.next=4,z(d,r,e,t,!0);case 4:b=m()(e),f=Object(s.a)({},u[b],{type:"added"}),n({type:k,contacts:Object(i.a)({},b,f)}),n(Object(h.f)(f));case 8:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function K(e,t){return function(){var a=Object(o.a)(c.a.mark(function a(n,r,s){var i,o,l;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=s(),o=i.client,a.next=3,z(o,r,e,t,!1);case 3:l=m()(e),n({type:x,hash:l});case 5:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}},36:function(e,t,a){"use strict";a.d(t,"a",function(){return f}),a.d(t,"b",function(){return h}),a.d(t,"e",function(){return v}),a.d(t,"d",function(){return g}),a.d(t,"c",function(){return y}),a.d(t,"h",function(){return T}),a.d(t,"f",function(){return N}),a.d(t,"j",function(){return z}),a.d(t,"i",function(){return _}),a.d(t,"g",function(){return P});var n=a(82),r=a(31),c=a(5),s=a.n(c),i=a(13),o=a(185),l=a(266),u=a(24),p=a.n(u),d=a(166),m=a.n(d),b=a(68),f="CHATS_RESTORE",h="CHAT_CREATE",v="CHAT_SUBSCRIBE",g="CHAT_SEND_MESSAGE",y="CHAT_RECEIVE_MESSAGE";function E(e){return{key:e.key,data:e.msg.toObject()}}function O(e,t){var a=t[e];if(!a)throw new Error("Chat is not found");return a}function j(e,t){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(s.a.mark(function e(t,a){var r,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.pss.createTopicSubscription(a.topic),t.pss.setPeerPublicKey(a.key,a.topic,a.address)]);case 2:return r=e.sent,c=Object(n.a)(r,1),i=c[0],e.abrupt("return",i.pipe(Object(o.a)(E),Object(l.a)(function(e){return"chat_message"===e.data.type&&null!=e.data.payload}),Object(o.a)(function(e){return{key:e.key,type:e.data.type,utc_timestamp:e.data.utc_timestamp,payload:e.data.payload}})));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n){var r,c,i,o,l;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t(),c=r.chats,i=p()(n.key),o=O(i,c),l={sender:i,isRead:!1,text:n.payload.text,timestamp:n.utc_timestamp},!o.messages[p()(l)]){a.next=7;break}return a.abrupt("return");case 7:e({type:y,hash:i,message:l});case 8:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function w(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n,r){var c,i,o,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=r(),i=c.client,t.next=3,j(i,e);case 3:o=t.sent,l=o.subscribe(x(a,n)),a({type:v,sub:l});case 6:case"end":return t.stop()}},t)}));return function(e,a,n){return t.apply(this,arguments)}}()}function C(e,t){Object.values(t).map(function(t){return e(w(t))})}function T(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n){var r,c,i,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n(),c=r.app,i=c[e]||{},o=i.chats||{},a({type:f,chats:o}),C(a,o);case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function N(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n){var c,i,o,l,u;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=n(),o=i.account,l=p()(e.key),u={key:e.key,topic:e.topic,address:e.address,participants:(c={},Object(r.a)(c,l,e.key),Object(r.a)(c,p()(o.publicKey),o.publicKey),c),messages:{}},a({type:h,chats:Object(r.a)({},l,u)}),a(w(u));case 5:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function S(e,t,a,n,r){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(s.a.mark(function e(t,a,n,r,c){var i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={type:"chat_message",payload:{text:c},utc_timestamp:Date.now()},e.next=3,a.pss.sendAsym(n.key,n.topic,i);case 3:o={sender:p()(r),isRead:!0,timestamp:Date.now(),text:c},t({type:g,hash:p()(n.key),message:o});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n,r,c){var i,o,l,u,p,d;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=r(),o=i.account,l=i.chats,u=O(e,l),p=c(),d=p.client,S(n,d,u,o.publicKey,t);case 4:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function _(e,t){return function(){var a=Object(i.a)(s.a.mark(function a(n,r,c){var i,o,l,u,p,d,m,f,h,v,g;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=r(),o=i.account,l=i.chats,u=O(e,l),p=c(),d=p.client,m=d.bzz,a.next=6,Object(b.c)(t);case 6:return f=a.sent,h=f.currentTarget.result,a.next=10,m.uploadFile(h,{contentType:t.type});case 10:v=a.sent,g="bzz:/".concat(v),S(n,d,u,o.publicKey,g);case 13:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()}function P(e){return function(){var t=Object(i.a)(s.a.mark(function t(a,n,r){var c,i,o,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=r(),i=c.client,o=i.bzz,t.next=4,o.download(e);case 4:return l=t.sent,t.t0=m.a,t.next=8,l.blob();case 8:return t.t1=t.sent,t.next=11,t.t0.saveAs.call(t.t0,t.t1);case 11:case"end":return t.stop()}},t)}));return function(e,a,n){return t.apply(this,arguments)}}()}},68:function(e,t,a){"use strict";a.d(t,"b",function(){return n}),a.d(t,"c",function(){return r}),a.d(t,"a",function(){return c});var n=function(e,t){return e.reduce(function(e,a){return(e[a[t]]=e[a[t]]||[]).push(a),e},{})},r=function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=t,n.readAsArrayBuffer(e)})},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.substring(0,2+2*t)||"0x"}}},[[201,1,2]]]);
//# sourceMappingURL=main.f4a91831.chunk.js.map